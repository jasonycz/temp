window.define("pages/profile/profile",function(e,t,a,o,i,s,r,n,l,d,f,c,u,h,g,m){"use strict";var p=e("../../store/index"),I=e("../../utils/checkin"),T=e("../../utils/loginUtil"),D=function(e){return e&&e.__esModule?e:{default:e}}(T),w=e("../../utils/networkUtil.js"),S=e("../../utils/userUtil.js"),U=(e("../../utils/util.js"),e("../../utils/event.js"),e("../../utils/parseUtil.js")),P=(e("../../utils/abtest/abtest.js"),s());Page({data:{page:1,userInfo:{},feedInfo:[],hasMoreData:!0,loadTag:!1,nickName:"",error:!1,startLoading:!1,refreshType:"auto",loadProfileError:!1,showFollow:!0,showloading:!1,animationData:{},rotateIndex:0,notExist:!1,uid:0,isAccoutAbnormalDialog:!1,errorType:"",errorMsg:"",isShowLoginDialog:!1,gotUserInfo:!1,showCommentBox:!1,commentBlogId:0,contentHeight:P.globalData.realWindowHeight,showRepostChoosenToast:!1,repostChoosenToastTop:0,showEntry:!1,profileScheme:"",showToHome:!1},shareImgPath:"",onLoad:function(e){i.setMetaDescription&&i.setMetaDescription({content:"一手明星动态，时下热点事件，搞笑幽默段子微博等你来看。",success:function(e){console.log("设置成功")},fail:function(e){console.log("设置失败"),console.log(e)}}),i.setMetaKeywords&&i.setMetaKeywords({content:"微博, 小程序",success:function(e){console.log("设置成功")},fail:function(e){console.log("设置失败"),console.log(e)}}),i.setDocumentTitle&&i.setDocumentTitle({title:"微博"}),this.setData({nickName:decodeURI(e.nickname),loadTag:!P.globalData.gotUserInfo,uid:e.uid||P.globalData.uid,profileScheme:"sinaweibo://userinfo?luicode=10000360&lfid=miniprogram&nick="+decodeURI(e.nickname)}),P.sensors.track("detailView",{objectUid:e.objectUid?e.objectUid.toString():"",luicode:e.luicode?e.luicode.toString():""}),i.showLoading({title:"加载中"}),this.loadData(),this.animation=i.createAnimation({duration:2e3,timingFunction:"linear"})},loadData:function(){var e=this;if(this.setData({startLoading:!0,error:!1}),"auto"==this.data.refreshType){var t={nickname:this.data.nickName,uid:this.data.uid};setTimeout(function(){0==Object.keys(e.data.userInfo).length&&w.getUserProfile(t,e.getUserInfoSuccessHandler.bind(e),e.getUserInfoFailHandler.bind(e))},1e3),D.default.checkUserStatus(function(){w.getUserProfile(t,e.getUserInfoSuccessHandler.bind(e),e.getUserInfoFailHandler.bind(e))})}},onShow:function(){var e=this.data.feedInfo,t={isShowLoginDialog:!1,loadTag:0==P.globalData.userStatus,gotUserInfo:P.globalData.gotUserInfo,showToHome:P.globalData.showToHome};if(I.condition.call(this,t),e.length){var a=(0,p.calcData)(e);a&&this.setData({statuses:a})}this.setData(t),1==P.globalData.userStatus&&0==this.data.startLoading&&this.onReachBottom()},loadProfileTimeline:function(){this.setData({loadProfileError:!1}),"auto"==this.data.refreshType?w.getProfileTimeline(this.data.userInfo.id,this.data.page,this.getProfileTimelineSuccessHandler.bind(this),this.getProfileTimelineFailHandler.bind(this)):this.onReachBottom()},onReachBottom:function(){P.sensors.track("refresh",{refreshType:"loadmore"}),this.data.error||this.data.loadProfileError||(P.sensors.track("refresh",{refreshType:"loadmore"}),this.setData({refreshType:"loadmore"}),0!=this.data.feedInfo.length&&this.data.userInfo&&(this.setData({hasMoreData:!0}),this.data.page=this.data.page+1,w.getProfileTimeline(this.data.userInfo.id,this.data.page,this.getProfileTimelineSuccessHandler.bind(this),this.getProfileTimelineFailHandler.bind(this))))},onShareAppMessage:function(e){if("menu"==e.from||"menu"==e.from.from)return{title:"分享"+this.data.userInfo.name+"的 个人主页",content:"粉丝数: "+this.data.userInfo.followersCount,imageUrl:this.data.userInfo.avatar,path:"/pages/profile/profile?nickname="+encodeURIComponent(this.data.userInfo.name)};var t=e.from.target||e.target,a=t.target.dataset.card;return U.parseShareMessage(a)},previewImage:function(e){var t=[];t.push(e.target.dataset.src),i.previewImage({current:e.target.dataset.src,urls:t})},getUserInfoSuccessHandler:function(e){var t=this;if(!e||"-100"!=e.errno&&"-200"!=e.errno)!e||"20003"!=e.errno&&"20034"!=e.errno?e&&e.errno||e.state_code&&0!=e.state_code?(this.setData({startLoading:!1,error:!0}),i.hideLoading()):(this.setData({startLoading:!1,userInfo:S.parseProfile(this.data.nickName,e.data)}),i.hideLoading(),w.getProfileTimeline(this.data.userInfo.id,this.data.page,this.getProfileTimelineSuccessHandler.bind(this),this.getProfileTimelineFailHandler.bind(this))):(this.setData({notExist:!0,startLoading:!1,userInfo:S.parseProfile(this.data.nickName,e.data)}),i.hideLoading());else{var a={nickname:this.data.nickName,uid:this.data.uid};D.default.updateUserStatus(function(){w.getUserProfile(a,t.retryGetUserInfoSuccessHandler.bind(t),t.getUserInfoFailHandler.bind(t))})}},retryGetUserInfoSuccessHandler:function(e){!e||"-100"!=e.errno&&"-200"!=e.errno?this.getUserInfoSuccessHandler(e):this.getUserInfoFailHandler()},getUserInfoFailHandler:function(e){this.setData({startLoading:!1,error:!0}),i.hideLoading()},forCatch:function(){},retryGetProfileTimelineSuccessHandler:function(e){e&&e.data&&("-100"==e.data.errno||"-200"==e.data.errno)?this.setData({loadProfileError:!0}):this.getProfileTimelineSuccessHandler(e)},getProfileTimelineSuccessHandler:function(e){var t=this;if(e&&e.data&&("-100"==e.data.errno||"-200"==e.data.errno))D.default.updateUserStatus(function(){w.getProfileTimeline(t.data.userInfo.id,t.data.page,t.retryGetProfileTimelineSuccessHandler.bind(t),t.getProfileTimelineFailHandler.bind(t))});else if(e&&e.errno||e.state_code&&0!=e.state_code)this.setData({loadProfileError:!0});else{var a=S.parseProfileTimeline(e);if("auto"==this.data.refreshType)this.setData({feedInfo:a.statuses,hasMoreData:a.statuses.length>=3});else{if(0==a.statuses.length)return void this.setData({hasMoreData:!1});this.setData({hasMoreData:!1,feedInfo:this.data.feedInfo.concat(a.statuses)})}}},getProfileTimelineFailHandler:function(e){this.setData({loadProfileError:!0})},toSelfFollowed:function(){i.navigateTo({url:"/pages/SelfFollowed/SelfFollowed?from=followed"})},toSelfFans:function(){i.navigateTo({url:"/pages/SelfFollowed/SelfFollowed?from=fans"})}})}),window.__swanRoute="pages/profile/profile",window.usingComponents=["common/FeedList/FeedList","common/NetworkErrorToast/NetworkErrorToast","common/NetworkErrorItem/NetworkErrorItem","common/ToHomeButton/ToHomeButton"],require("pages/profile/profile");