window.define("tabs/brandlist/index",function(t,a,o,i,e,n,s,d,l,r,c,u,g,h,f,L){"use strict";function S(t){return t&&t.__esModule?t:{default:t}}var C=t("../../network/api.js"),p=S(C),b=t("../../utils/const.js"),w=S(b),m=t("../../utils/notification"),N=S(m),_=t("../../utils/location.js"),q=S(_);Page({data:{locationSuccess:!0,loadmore:!1,loadingmore:!1,query:{pageNo:1,pageSize:20}},init:function(){var t=this,a=n().globalConfig;if(a)if(this.setData(Object.assign({},this.data,{globalConfig:a})),a.isEnableLocation){var o=n().globalData.location;o&&o.location?(this.setData({location:o}),this.queryBrandList({pageNo:1,pageSize:20},!0)):(e.showLoading({title:"定位中..."}),q.default.ensureLocation(a).then(function(){e.hideLoading()}).catch(function(a){console.log(a),t.setData({locationSuccess:!1}),e.hideLoading()}))}else e.showLoading({title:"请稍候"}),this.queryBrandList({pageNo:1,pageSize:20},!0)},onLoad:function(){var t=this;N.default.register(w.default.action.QUERY_CONFIG_SUCCESS,this,function(){t.init()}),N.default.register(w.default.action.LOCATION_CHANGED,this,function(a){t.setData({location:a.data,locationSuccess:!0}),e.showLoading({title:"请稍候"}),t.queryBrandList({pageNo:1,pageSize:20},!0)}),this.init()},queryBrandList:function(t,a){var o=this;p.default.getBrandListByLocation(t).then(function(t){console.log(t,"++++"),e.hideLoading(),o.setData({list:a?t.data.data:o.data.list.concat(t.data.data),isShow:!0,loadmore:t.data.nextCursor>0,loadingmore:!1,query:{pageNo:t.data.nextCursor,pageSize:t.data.pageSize}}),console.log(t,"++++++++++++")}).catch(function(t){return console.log(t)})},handlestorelist:function(t){var a=t.currentTarget.dataset.brand;n().setFlash("brand",a),e.navigateTo({url:"/pages/storelist/storelist"})},lower:function(t){console.log(this.data.loadmore,!this.data.loadingmore,"+++++++++++++++++"),this.data.loadmore&&!this.data.loadingmore&&(console.log(t),this.setData({loadingmore:!0}),this.queryBrandList(this.data.query,!1))},onUnload:function(){N.default.remove(w.default.action.QUERY_CONFIG_SUCCESS,this),N.default.remove(w.default.action.LOCATION_CHANGED,this)}})}),window.__swanRoute="tabs/brandlist/index",window.usingComponents=[],require("tabs/brandlist/index");