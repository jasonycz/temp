window.define("tabs/mine/index",function(o,n,e,t,i,a,c,s,u,l,p,r,g,h,d,f){"use strict";function m(o){return o&&o.__esModule?o:{default:o}}function x(o,n,e){return n in o?Object.defineProperty(o,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):o[n]=e,o}var w=o("../../utils/util"),y=m(w),S=o("../../network/api"),b=m(S),v=o("../../utils/const.js"),k=m(v),I=o("../../utils/notification.js"),D=m(I),T=o("../../dist/index"),C=m(T),U={data:{isShow:!1,order:{}}};y.default.registComp(U,C.default.Toast,{onShareAppMessage:function(){return{path:"/tabs/home/index?shareCode="+a().globalData.userinfo.shareCode}},onLoad:function(){i.showLoading({title:"加载中"});var o=a().globalData.color;this.setData({color:o})},onShow:function(){var o=this,n=i.getExtConfigSync();console.log("ext",n);var e=i.getStorageSync("userinfo");console.log(e,"++++++++++++++++++++++++"),this.setData({userInfo:e}),this.updateUser(),this.queryMine(),b.default.getStaticticsOrderNum().then(function(n){n&&n.data&&n.data.forEach(function(n){o.setData(x({},"order["+n.orderStatus+"]",n.num))})})},updateUser:function(){var o=this;i.getStorageSync("userUpdated")?this.lookup():i.getUserInfo({success:function(n){b.default.updateWXUserInfo(n.userInfo).then(function(){i.setStorageSync("userUpdated","yes"),o.lookup()})},fail:function(){o.lookup()}})},lookup:function(){var o=this,n=this;b.default.queryUserInfo().then(function(e){if(i.stopPullDownRefresh(),console.log("bingooooooooooooo",e),i.hideLoading(),i.setStorageSync("userinfo",e.data),n.setData({userInfo:e.data}),e.data&&e.data.mobile){console.log(" res.data---\x3e",e.data);var t=e.data.mobile.substring(0,3)+"****"+e.data.mobile.substr(7,10);o.setData({mobile:t,"userInfo.mobileHidden":t})}}).catch(function(o){return console.log(o)})},logout:function(){var o=this;i.showLoading({title:"加载中"}),b.default.logout().then(function(n){i.stopPullDownRefresh(),console.log("bingooooooooooooo",n),n.data.result&&o.lookup()}).catch(function(o){return console.log(o)})},showToast:function(o){this.showZanToast(o)},queryMine:function(){var o=this,n={sign:"profile"};b.default.getIndexMenu(n).then(function(n){i.stopPullDownRefresh(),console.log("bingooooooooooooo",n),i.hideLoading(),o.setData({mine:n.data.options,isShow:!0}),o.genMenu(n.data.options)}).catch(function(o){return console.log(o)})},genMenu:function(o){var n=[];1==o.balanceIsShow&&n.push({type:"balance",title:"我的余额",icon:"http://imgcdnali.wfenxiao.com.cn/xcx/c/1120/balance.png",url:"/pages/storevalue/mybalance/index"}),1==o.collectionIsShow&&n.push({type:"collection",title:"我的收藏",icon:"http://imgcdnali.wfenxiao.com.cn/xcx/c/1120/mine-collection.png",url:"/pages/mine/collection/index"}),1==o.couponIsShow&&n.push({type:"coupon",title:"优惠券",icon:"http://imgcdnali.wfenxiao.com.cn/xcx/c/sicons/coupon.png",url:"/pages/mine/coupons/coupons"}),1==o.cardIsShow&&n.push({type:"card",title:"会员卡",icon:"http://imgcdnali.wfenxiao.com.cn/xcx/c/sicons/card.png",url:"/pages/mine/cards/cards"}),1==o.pointsIsShow&&n.push({type:"score",title:"我的积分",icon:"http://imgcdnali.wfenxiao.com.cn/xcx/c/sicons/score.png",url:"/pages/mine/scores/scores"}),1==o.giftCardShow&&n.push({type:"giftcard",title:"我的礼品卡",icon:"http://imgcdnali.wfenxiao.com.cn/xcx/c/sicons/giftcards.png",url:"/pages/giftcard/mygiftcard/index"}),1==o.yuyueIsShow&&n.push({type:"yuyue",title:"我的预约",icon:"http://imgcdnali.wfenxiao.com.cn/xcx/c/sicons/yuyue.png",url:"/pages/services/orders/index"}),1==o.evaluateIsShow&&n.push({type:"evaluate",title:"我的评价",icon:"http://imgcdnali.wfenxiao.com.cn/xcx/c/1120/evaluate.png",url:"/pages/pingjia/myevaluate/index?sType=8"}),1==o.distributionIsShow&&n.push({type:"fenxiao",title:o.distributionName,icon:"http://imgcdnali.wfenxiao.com.cn/xcx/c/sicons/fenxiao.png",url:"/pages/fenxiao/center/index"}),1==o.distributionGoodsIsShow&&n.push({type:"fenxiaoGoods",title:"分销商品库",icon:"http://imgcdnali.wfenxiao.com.cn/xcx/c/sicons/fenxiaogoods.png",url:"/pages/fenxiao/products/index?type=mylist"}),1==o.fightGroupShow&&n.push({type:"tuan",title:"我的拼团",icon:"http://imgcdnali.wfenxiao.com.cn/xcx/c/sicons/tuan.png",url:"/pages/tuan/mytuan/index"}),1==o.hotelIsShow&&n.push({type:"hotel",title:"我的酒店",icon:"http://imgcdnali.wfenxiao.com.cn/xcx/c/sicons/hotel.png",url:"/pages/hotel/orders/index"}),1==o.foodIsShow&&n.push({type:"food",title:"我的餐饮",icon:"http://imgcdnali.wfenxiao.com.cn/xcx/c/sicons/food.png",url:"/pages/food/myfood/index"}),1==o.timesCardIsShow&&n.push({type:"timescard",title:"次卡",icon:"http://imgcdnali.wfenxiao.com.cn/xcx/c/sicons/timescard-icon.png",url:"/pages/car/my/index"}),1==o.carProjectIsShow&&n.push({type:"carprojectorders",title:"汽车服务",icon:"http://imgcdnali.wfenxiao.com.cn/xcx/c/sicons/carservice-icon.png",url:"/pages/car/projectorders/index"}),1==o.supplyShow&&n.push({type:"supply",title:"我的供求",icon:"http://imgcdnali.wfenxiao.com.cn/xcx/c/sicons/supply.png",url:"/pages/gongqiu/mygongqiu/index"}),1==o.liveIsShow&&n.push({type:"live",title:"我的直播",icon:"http://imgcdnali.wfenxiao.com.cn/xcx/c/live/mylive.png",url:"/pages/live/favorites/index"}),1==o.courseShow&&n.push({type:"courseShow",title:"我的课程",icon:"http://imgcdnali.wfenxiao.com.cn/xcx/c/sicons/course.png",url:"/pages/edu/favorites/index"}),o.online&&1==o.online.isShow&&n.push({type:"contact",title:"客服",icon:"http://imgcdnali.wfenxiao.com.cn/xcx/c/sicons/contact.png"}),o.link&&1==o.link.isShow&&n.push({type:"phone",title:"电话",icon:"http://imgcdnali.wfenxiao.com.cn/xcx/c/sicons/phone.png",bindtap:"makephone"}),o.about&&1==o.about.isShow&&n.push({type:"about",title:"关于我们",icon:"http://imgcdnali.wfenxiao.com.cn/xcx/c/sicons/about.png",bindtap:"makeabout"}),1==o.bargainIsShow&&n.push({type:"bargainIsShow",title:"我的砍价",icon:"http://imgcdnali.wfenxiao.com.cn/xcx/c/sicons/cutprice.png",url:"/pages/mine/cutprice/index"}),this.setData({menus:n})},makephone:function(){var o=this.data.mine.link,n=o.telephone,e=o.phone,t=o.extNum;console.log(this.data.mine.link,"kkkkkkkkkkkkkkkkkk");var a=[];if(n&&(t?a.push(n+"转"+t):a.push(n)),e&&a.push(e),a.length>0){this.setData({phoneList:a});var c=this.selectComponent(".phoneaction");c&&c.show()}else i.makePhoneCall({phoneNumber:a[0]})},makeabout:function(){i.navigateTo({url:"/pages/aboutmine/aboutmine?aboutmine="+JSON.stringify(this.data.mine.about)})},handleLogin:function(){i.navigateTo({url:"/pages/login/login"})},navToProfile:function(){var o=this.data.userInfo;o.mobile?(a().setFlash("userInfo",o),i.navigateTo({url:"/pages/mine/user/profile/index"})):i.navigateTo({url:"/pages/login/login"})},handleMakeUrl:function(o){var n=o.currentTarget.dataset.url;this.data.userInfo.mobile?i.navigateTo({url:n}):i.navigateTo({url:"/pages/login/login"})},onUnload:function(){D.default.remove(k.default.action.BIND_PHONE_SUCCESS,this)},onHide:function(){this.setData({showModal:!1,url:"/pages/login/login"})},changeuser:function(){var o=i.getStorageSync("userinfo");this.setData({userInfo:o})}}),Page(U)}),window.__swanRoute="tabs/mine/index",window.usingComponents=["component/phonemodal/phonemodal","component/phone_action/index"],require("tabs/mine/index");