window.define("pages/tuan/detail/index",function(e,t,o,a,i,n,r,d,s,u,l,c,p,g,h,f){"use strict";function m(e){return e&&e.__esModule?e:{default:e}}function T(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var v=e("../../../network/api.js"),w=m(v),D=e("../../../utils/util.js"),G=m(D),k=e("../../../component/cart_popup/index.js"),y=m(k),I=e("../../../dist/index"),S={};G.default.registComp(S,y.default,I.TopTips,{data:{},onLoad:function(e){var t=e.id,o=n().globalData.userinfo;this.setData({userinfo:o}),i.showLoading({title:"请稍后"}),this.queryTuanDetail(t)},onUnload:function(){this.timer&&(clearInterval(this.timer),this.timer=void 0)},queryTuanDetail:function(e){var t=this;w.default.queryOpenTuanDetail({id:e}).then(function(e){var o=e.data;i.hideLoading(),t.setData({detail:o}),1==o.status&&console.log("bingo"),o.remainTime>0&&t.startCount()}).catch(function(e){console.log(e),i.hideLoading()})},queryTuanGoodsSku:function(){var e=this,t=n().globalData.userinfo;if(!t||!t.mobile)return void this.setData({showModal:!0,url:"/pages/login/login"});var o=this.data.detail;i.showLoading({title:"请稍后"}),w.default.queryTuanGoodsSku({id:o.id}).then(function(t){i.hideLoading();var a=t.data,n=a.stock,r=a.goodsItem,d=a.goodsSku;e.setData({"currentGood.id":o.goodsId,"currentGood.name":o.goodsName,"currentGood.imgUrl":o.imgUrl,"currentGood.price":o.groupPrice,"currentGood.stock":n,"currentGood.num":1,"currentGood.specs":r,"currentGood.skus":d,"currentGood.selectedSpec":new Array(r.length),"currentGood.selectedSpecValue":"","currentGood.selectedSku":void 0,showDialog:!0})}).catch(function(e){i.hideLoading(),console.log(e)})},startCount:function(){var e=this,t=this.data.detail;this.setData(T({},"detail.leftTime",G.default.renderTimer(t.remainTime)));var o=this;this.timer=setInterval(function(){var a;if(0==t.remainTime)return clearInterval(e.timer),void o.setData(T({},"detail.status",3));var i=t.remainTime-1;o.setData((a={},T(a,"detail.remainTime",i),T(a,"detail.leftTime",G.default.renderTimer(i)),a))},1e3)},handleBuy:function(e){var t=e.currentTarget.dataset.type;this.setData({openType:t}),this.queryTuanGoodsSku()},handleCreateTuan:function(e){var t=this;console.log("e--\x3e",e);var o=this.data,a=o.openType,n=o.detail,r=e.detail,d={};"join"==a?d.sponsorId=n.id:d.groupId=n.groupId,i.showLoading({title:"请稍候"}),w.default.checkoutSingleOrder(Object.assign({goodsId:r.id,propertiesId:r.selectedSku&&r.selectedSku.propertiesId?r.selectedSku.propertiesId:0,num:r.num,consigneeId:-1},d)).then(function(e){i.hideLoading();var t=e.data;i.navigateTo({url:"/pages/orders/new/new?order="+G.default.stringify(t)})}).catch(function(e){console.log("err----\x3e",e),"100001"==e.error?t.showZanTopTips(e.errorMessage||"网络链接错误"):t.showZanTopTips("订单提交失败"),i.hideLoading()})},onShareAppMessage:function(){var e=this.data,t=e.detail,o=e.userinfo;return{title:"["+t.limitPeople+"人团]"+t.goodsName,path:"/pages/tuan/detail/index?id="+t.id+"&shareCode="+o.shareCode}}}),Page(S)}),window.__swanRoute="pages/tuan/detail/index",window.usingComponents=["component/phonemodal/phonemodal","component/cart_popup/index"],require("pages/tuan/detail/index");