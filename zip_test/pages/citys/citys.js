window.define("pages/citys/citys",function(t,e,a,i,o,c,n,s,l,u,d,r,h,y,f,g){"use strict";function L(t){return t&&t.__esModule?t:{default:t}}var C=t("../../network/api"),w=L(C),v=t("../../utils/const.js"),N=L(v),p=t("../../utils/notification"),m=L(p),D=t("../../utils/location.js"),S=L(D);Page({data:{},onLoad:function(t){t.city&&this.setData({city:t.city}),t.isLocation&&this.setData({isLocation:t.isLocation}),t.from&&this.setData({type:t.from});var e=o.getStorageSync("config");this.setData({config:e}),this.querycitys()},hotCity:function(){this.setData({scrollTop:0})},clickLetter:function(t){console.log(t.currentTarget.dataset.letter);var e=t.currentTarget.dataset.letter;this.setData({showLetter:e,isShowLetter:!0,scrollTopId:e});var a=this;setTimeout(function(){a.setData({isShowLetter:!1})},1e3)},querycitys:function(){var t=this;o.showLoading({title:"加载中"}),w.default.queryIndexCityV2().then(function(e){o.stopPullDownRefresh(),t.setData({isShow:!0,cityList:e.data.cityList,shortNames:e.data.shortNames,hots:e.data.hotCityList},function(){o.hideLoading()}),console.log(e,"+++++++++++")}).catch(function(t){return console.log(t)})},bindCity:function(t){var e=t.currentTarget.dataset.city;if(console.log(e,"+++++++++++++++++++++"),this.setData({searchShow:!1,searchlist:[],city:e.cityName}),o.showLoading({title:"加载中"}),"hotel"==this.data.type)m.default.post(N.default.action.HOTEL_LOCATION_CHANGED,{location:e.cityName,cityName:e.cityName,isLocation:2,cityCode:e.cityCode}),o.navigateBack();else if("search"==this.data.type)m.default.post(N.default.action.SEARCH_CITY,e.cityName),o.navigateBack();else{var a=o.getStorageSync("location"),i=a.latitude,n=void 0===i?"":i,s=a.longitude,l=void 0===s?"":s;w.default.selectIndexCityV2({cityCode:e.cityCode,latitude:""+n,longitude:""+l}).then(function(t){if(o.stopPullDownRefresh(),o.hideLoading(),t.data.result){var a=c().globalData.location,i=Object.assign({},a,{location:e.cityName,cityName:e.cityName,cityCode:e.cityCode});c().globalData.location=i,o.setStorageSync("location",i),m.default.post(N.default.action.HOTEL_LOCATION_CHANGED,{location:e.cityName,cityName:e.cityName,isLocation:2,cityCode:e.cityCode}),m.default.post(N.default.action.LOCATION_CHANGED,i),o.navigateBack()}}).catch(function(t){return console.log(t)})}},searchCtiy:function(t){var e=this;if(console.log(t.detail.value),""!==t.detail.value){var a={keyword:t.detail.value};w.default.queryIndexSearchCity(a).then(function(t){o.stopPullDownRefresh(),o.hideLoading(),e.setData({searchShow:!0,searchlist:t.data}),console.log(t,"+++++++++++")}).catch(function(t){return console.log(t)})}},removesearch:function(t){""==t.detail.value&&this.setData({searchShow:!1,searchlist:[]})},getLocation:function(){var t=this,e=this;o.showLoading({title:"定位中..."}),S.default.getLocationInfo().then(function(e){console.log(e,"res"),"hotel"==t.data.type&&m.default.post(N.default.action.HOTEL_LOCATION_CHANGED,{cityName:e.cityName,location:e.location,isLocation:1,cityCode:e.cityCode}),o.hideLoading(),o.navigateBack()}).catch(function(t){o.hideLoading(),console.log(t),e.showZanToast("定位失败，请重试定位或选择其他城市")})},makesetting:function(){var t=this;o.getSetting({success:function(e){e.authSetting["scope.userLocation"]?t.getLocation():o.openSetting({success:function(e){e.authSetting["scope.userLocation"]&&t.getLocation()}})}})},hideSearch:function(){this.setData({searchShow:!1})}})}),window.__swanRoute="pages/citys/citys",window.usingComponents=[],require("pages/citys/citys");