window.define("pages/pingjia/evaluateform/index",function(a,t,e,o,n,s,i,u,l,r,d,v,c,g,f,m){"use strict";function h(a){return a&&a.__esModule?a:{default:a}}function D(a,t,e){return t in a?Object.defineProperty(a,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):a[t]=e,a}var p=a("../../../network/api.js"),k=h(p),E=a("../../../dist/index"),F=h(E);Page(Object.assign({},F.default.TopTips,F.default.Toast,{data:{evaluateItems:[{title:"好评",index:1},{title:"中评",index:2},{title:"差评",index:3}],isBtn:!0},onLoad:function(a){var t=this;this.setData({orderNo:a.orderNo,type:a.type,id:a.id}),n.showLoading(),k.default.gotoEvaluate({orderNo:this.data.orderNo,type:this.data.type,id:this.data.id?this.data.id:0}).then(function(a){n.hideLoading(),a.data.info.length<=0?(console.log("kkkkkkkkkkkkkkkkkkkkkkkkkkkkk"),t.setData({evaluateFormData:Object.assign({},a.data,{info:[{evaluate:"",firstEvaluateContent:"",secondEvaluateContent:"",firstEvaluateImgs:[],secondEvaluateImgs:[],sType:2}]})})):t.setData({evaluateFormData:a.data})}).catch(function(a){return console.log(a)})},radioChange:function(a){console.log("radio发生change事件，携带value值为：",a.detail.value)},formSubmit:function(){for(var a=this,t=this.data.evaluateFormData.info,e=void 0,o=0;o<t.length;o++){if(!t[o].evaluate&&1==this.data.evaluateFormData.evaluateCount&&3!=this.data.type&&5!=this.data.type&&7!=this.data.type){e="请选择评价评级";break}if(!(t[o].firstEvaluateContent||3!=this.data.type&&5!=this.data.type&&5!=this.data.type)){e="请输入评价内容";break}if(!t[o].secondEvaluateContent&&2==this.data.evaluateFormData.evaluateCount){e="请输入评价内容";break}this.data.evaluateFormData.businessScore||1!=this.data.evaluateFormData.evaluateCount||(e="请给商家打分")}if(e)return void this.showZanToast(e);var s=Object.assign({anonymous:0},this.data.evaluateFormData,{evaluates:t.map(function(a){return Object.assign({firstEvaluateContent:"",secondEvaluateContent:""},a,{firstEvaluateImgs:a.firstEvaluateImgs?a.firstEvaluateImgs.join(","):"",secondEvaluateImgs:a.secondEvaluateImgs?a.secondEvaluateImgs.join(","):""})})});delete s.info,this.data.isBtn&&(this.setData({isBtn:!1}),k.default.queryEvaluatePublish(s).then(function(t){a.setData({isBtn:!0}),0==t.status&&t.data.result?(a.showZanToast("发布成功"),n.redirectTo({url:"/pages/pingjia/evaluatesuccess/index?evaluateCount="+a.data.evaluateFormData.evaluateCount})):a.showZanTopTips("发布失败，请重新发布")}).catch(function(t){a.setData({isBtn:!0}),console.log(t,"ooooooooooooooooooooooo"),a.showZanToast(t.errorMessage)}))},handleChooseImg:function(a){console.log("==============handleChooseImg==========");var t=a.currentTarget.dataset.index,e=this,o=void 0;o=1==e.data.evaluateFormData.evaluateCount?e.data.evaluateFormData.info[t].firstEvaluateImgs||[]:e.data.evaluateFormData.info[t].secondEvaluateImgs||[],n.chooseImage({count:5-o.length,sizeType:["compressed"],success:function(a){console.log("==============success==========",a);var o=a.tempFilePaths;console.log(o,"[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[");for(var n=0;n<o.length;n++)k.default.uploadImage(o[n]).then(function(a){if(console.log("============= api.uploadImage==========",a),1==e.data.evaluateFormData.evaluateCount){console.log("ttttttttttttttttttttttttttt");var o=e.data.evaluateFormData.info[t].firstEvaluateImgs,n=void 0===o?[]:o;n.push(a.url),e.setData(D({},"evaluateFormData.info["+t+"].firstEvaluateImgs",n))}else{var s=e.data.evaluateFormData.info[t].secondEvaluateImgs,i=void 0===s?[]:s;i.push(a.url),e.setData(D({},"evaluateFormData.info["+t+"].secondEvaluateImgs",i))}}).catch(function(a){console.log("chooseimage",a)})},fail:function(){}})},handleRemoveImg:function(a){var t=a.currentTarget.dataset,e=t.index,o=t.imgindex;console.log(e,"index");var n=this.data.evaluateFormData.info[e],s=n.firstEvaluateImgs,i=n.secondEvaluateImgs;1==this.data.evaluateFormData.evaluateCount?(s.splice(o,1),this.setData(D({},"evaluateFormData.info["+e+"].firstEvaluateImgs",s))):(i.splice(o,1),this.setData(D({},"evaluateFormData.info["+e+"].secondEvaluateImgs",i)))},onTapPic:function(a){var t=a.currentTarget.dataset,e=t.index,o=t.imgindex,s=this.data.evaluateFormData.info[e],i=s.firstEvaluateImgs,u=s.secondEvaluateImgs;console.log("e--\x3e",a),n.previewImage({current:i?i[o]:u[o],urls:i||u})},onSwitch:function(a){var t=a.detail.value;console.log("onSwitch-----checked--=------\x3e",t),this.setData({"evaluateFormData.anonymous":t?1:0})},onEvaluateType:function(a){console.log("+++++++++");var t=a.currentTarget.dataset,e=t.type,o=t.index;this.setData(D({},"evaluateFormData.info["+o+"].evaluate",e))},onChangeValue:function(a){var t=a.currentTarget.dataset.index,e=a.detail.value;1==this.data.evaluateFormData.evaluateCount?this.setData(D({},"evaluateFormData.info["+t+"].firstEvaluateContent",e)):this.setData(D({},"evaluateFormData.info["+t+"].secondEvaluateContent",e))},evaluateScroe:function(a){var t=a.currentTarget.dataset.item;this.setData({"evaluateFormData.businessScore":t})}}))}),window.__swanRoute="pages/pingjia/evaluateform/index",window.usingComponents=[],require("pages/pingjia/evaluateform/index");