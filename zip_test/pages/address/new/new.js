window.define("pages/address/new/new",function(t,e,a,s,i,o,d,r,n,l,c,f,u,h,m,g){"use strict";function p(t){return t&&t.__esModule?t:{default:t}}var w=t("../../../dist/index"),y=p(w),D=t("../../../utils/util"),v=p(D),A=t("../../../network/api"),b=p(A),x={data:{isShow:!1,index:0,item:{},isbtn:!0,storetype:""}};v.default.registComp(x,y.default.Toast,{onLoad:function(t){var e=o().globalData.editionType;if(this.setData({storetype:e}),"edit"==t.type){var a=v.default.parse(t.item);this.setData({item:a})}if(t.search){var s=v.default.parse(t.search),i=v.default.parse(t.item);this.setData({item:Object.assign({},i,{lng:s.location.lng,lat:s.location.lat,title:s.title})})}t.isWxAddress&&this.setData({isWxAddress:!0}),t.isAddress&&this.setData({isAddress:!0}),t.scoreorder&&(t.ordertype&&this.setData({ordertype:t.ordertype}),this.setData({scoreorder:v.default.parse(t.scoreorder),formData:v.default.parse(t.formData)})),this.setData({type:t.type})},onReady:function(){},onShow:function(){var t=o().getFlash("address"),e=o().getFlash("searchAddress");console.log(e),t&&(this.data.item.city!==t.city.fullName&&this.setData({"item.title":"","item.lng":"","item.lat":""}),this.setData({"item.province":t.province.fullName,"item.cityCode":t.city.code,"item.city":t.city.fullName,"item.district":t.district.fullName||""})),e&&(console.log(e),this.setData({"item.lng":e.location.lng,"item.lat":e.location.lat,"item.title":e.title}))},formSubmit:function(){var t=void 0,e=this.data.item,a=e.province,s=e.city,i=e.district,o=e.title,d=e.address,r=e.name,n=e.phone,l=e.cityCode,c=e.lng,f=e.lat,u=e.adcode;if(s&&a?d&&0!=d.trim().length?r&&0!=r.trim().length?n&&0!=n.trim().length?/^1[0-9]{10}$/.test(n.trim())||(t="手机号码格式错误"):t="请输入手机号码":t="请输入姓名":t="请输入详细地址":t="请选择收货地区",t)this.showToast(t);else{var h={name:r,phone:n,address:d,province:a,city:s,district:i,adcode:l||u};if(o&&(h=Object.assign({},h,{title:o,lng:c,lat:f})),"new"==this.data.type)this.createAddress(h,!1);else{var m=this.data.item;h.id=m.id||"",this.editAddress(h,!1)}}},checkAddress:function(t,e,a){var s=this;b.default.isOutRange(t).then(function(t){if(console.log(t,"+++++++++++"),1==t.data.isOutRange){var o=s;i.showModal({content:"您的地址已超出商家配送范围",cancelText:"调整地址",confirmText:"仍然保存",success:function(t){t.confirm&&("edit"==a?o.data.isWxAddress?o.createWxAddress(e,!0):o.editAddress(e,!0):o.createAddress(e,!0))}})}else delete e.storeId,"edit"==a?s.data.isWxAddress?s.createWxAddress(e,!1):s.editAddress(e,!1):s.createAddress(e,!1)}).catch(function(t){return console.log(t)})},showToast:function(t){this.showZanToast(t)},onCommentChange:function(t){var e=this.data.item;e[t.target.id]=t.detail.value,this.setData({item:e})},createAddress:function(t){var e=this;console.log(this.data,"this.data.isbtn"),this.data.isbtn&&(this.setData({isbtn:!1}),i.showLoading({title:"请稍后"}),b.default.createAddress(t).then(function(t){if(console.log("bingooooooooooooo",t),e.setData({isbtn:!0}),e.data.scoreorder){var a=e.data.scoreorder;a.consignee=t.data,e.data.ordertype?(console.log(a,"scoreorder"),e.handleJump("/pages/orders/new/new?from=address&order="+v.default.stringify(a)+"&formData="+v.default.stringify(e.data.formData))):e.handleJump("/pages/mine/scores/score_new_order?from=address&scoreorder="+v.default.stringify(a)+"&formData="+v.default.stringify(e.data.formData))}else i.navigateBack({delta:1})}).catch(function(t){console.log(t),e.setData({isbtn:!0})}))},editAddress:function(t){var e=this;this.data.isbtn&&(this.setData({isbtn:!1}),i.showLoading({title:"请稍后"}),b.default.updataAddress(t).then(function(t){if(i.stopPullDownRefresh(),i.hideLoading({title:"请稍后"}),e.setData({isbtn:!0}),e.data.scoreorder){var a=e.data.scoreorder;a.consignee=t.data,e.data.ordertype?(console.log(a,"scoreorder"),e.handleJump("/pages/orders/new/new?from=address&order="+v.default.stringify(a)+"&formData="+v.default.stringify(e.data.formData))):e.handleJump("/pages/mine/scores/score_new_order?from=address&scoreorder="+v.default.stringify(a)+"&formData="+v.default.stringify(e.data.formData))}else i.navigateBack({delta:1})}).catch(function(t){console.log(t),e.setData({isbtn:!0})}))},handleJump:function(t){i.redirectTo({url:t})}}),Page(x)}),window.__swanRoute="pages/address/new/new",window.usingComponents=[],require("pages/address/new/new");