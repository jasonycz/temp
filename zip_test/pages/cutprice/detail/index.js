window.define("pages/cutprice/detail/index",function(e,t,i,a,r,n,s,o,d,c,u,l,g,h,p,f){"use strict";function m(e){return e&&e.__esModule?e:{default:e}}var v=e("../../../network/api"),I=m(v),w=e("../../../utils/util.js"),S=e("../../../utils/notification.js"),T=m(S),y=e("../../../utils/const.js"),P=m(y),C=e("../../../dist/index");Page(Object.assign({},C.Toast,{data:{querySuccess:!1,cutPrice:{},leftTime:{hours:0,minutes:0,seconds:0},showPhoneModal:!1,url:!1},onLoad:function(e){var t=this;e.bargainId?this.queryHelpBargain({id:e.bargainId}):this.queryToBargain({id:e.id,storeId:e.storeId}),T.default.register(P.default.action.CUT_PRICE_SUCCESS,this,function(i){console.log("kanjiachenggong====",i.data);var a=t.data.cutPrice;i.data.bargainSponsorId==a.id&&(e.bargainId?t.queryHelpBargain({id:e.bargainId}):t.queryToBargain({id:e.id,storeId:e.storeId}))})},onUnload:function(){clearInterval(this.interval),T.default.remove(P.default.action.CUT_PRICE_SUCCESS,this)},queryHelpBargain:function(e){var t=this;r.showLoading({title:"请稍后"}),I.default.helpBargain(e).then(function(e){r.hideLoading(),e.data.cutResult&&t.showCutFriendModal(),clearInterval(t.interval),t.setData({cutPrice:e.data,querySuccess:!0},t.setTime)}).catch(function(e){t.showZanTopTips(e.errorMessage||e.msg||I.default.errors(e.error)||"网络错误"),r.hideLoading(),t.setData({querySuccess:!1})})},queryToBargain:function(e){var t=this;r.showLoading({title:"请稍后"}),I.default.toBargain(e).then(function(e){r.hideLoading(),e.data.cutResult&&t.showCutSelfModal(),clearInterval(t.interval),t.setData({cutPrice:e.data,querySuccess:!0},t.setTime)}).catch(function(e){t.showZanTopTips(e.errorMessage||e.msg||I.default.errors(e.error)||"网络错误"),r.hideLoading(),t.setData({querySuccess:!1})})},setTime:function(){var e=this,t=this.data.cutPrice;1==t.status&&(this.interval=setInterval(function(){var i=t.timeLeft-1,a=(0,w.renderTimer)(i),r=24*parseInt(a.days)+parseInt(a.hours);e.setData({"cutPrice.timeLeft":i,leftTime:Object.assign({},a,{hours:r<9?"0"+r:r})})},1e3))},onShareAppMessage:function(){var e=["【最后1小时】帮我点一下，和我一起0元免费拿吧↓↓↓","【好友@我】朋友一声吼，砍价有木有↓↓↓","帮我砍价！你也有机会直接拿走商品↓↓↓","【好友@我】砍砍砍，砍至最低↓↓↓"];return{title:e[Math.floor(Math.random()*e.length)],imageUrl:this.data.cutPrice.imgs,path:"/pages/cutprice/detail/index?bargainId="+this.data.cutPrice.id}},showHelpModal:function(){var e=this.selectComponent("#help-modal");e&&e.show()},showCutSelfModal:function(){var e=this.selectComponent("#cut-modal-self");e&&e.show()},showCutFriendModal:function(){var e=this.selectComponent("#cut-modal-friend");e&&e.show()},friendCutPrice:function(){var e=this.data.cutPrice;this.queryToBargain({id:e.bargainId,storeId:e.storeId})},gopay:function(){var e=this,t=this.data.cutPrice;if(!r.getStorageSync("userinfo").mobile)return void this.setData({showPhoneModal:!0,url:"/pages/login/login"});1==t.type?(r.showLoading({title:"请稍后"}),I.default.checkoutSingleOrder({goodsId:t.goodsId,propertiesId:"",num:1,consigneeId:-1,bargainSponsorId:t.id}).then(function(e){r.hideLoading();var t=e.data;r.navigateTo({url:"/pages/orders/new/new?order="+(0,w.stringify)(t)})}).catch(function(t){e.showZanTopTips(t.errorMessage||t.msg||I.default.errors(t.error)||"网络错误"),r.hideLoading()})):2==t.type&&(n().setFlash("service",{storeId:t.storeId,id:t.service.id,serviceName:t.service.serviceName,servicePrice:t.bargainPrice,serviceImg:t.imgs,selectedSku:{},selectedSpecValue:""}),r.navigateTo({url:"/pages/services/order_create/index?bargainSponsorId="+t.id}))}}))}),window.__swanRoute="pages/cutprice/detail/index",window.usingComponents=["dist/minui/wxc-price/dist/index","pages/cutprice/components/help-modal/index","pages/cutprice/components/cut-modal-self/index","component/phonemodal/phonemodal","pages/cutprice/components/cut-modal-friend/index"],require("pages/cutprice/detail/index");