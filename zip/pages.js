window.define("pages/feed/feed",function(t,e,a,s,o,r,i,n,d,h,c,l,u,g,m,p){"use strict";function f(t){return t&&t.__esModule?t:{default:t}}function _(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var D=t("../../store/index"),S=(t("../../utils/checkin"),t("../../utils/loginUtil")),w=f(S),b=t("../../lib/CyclicTask"),T=(f(b),t("../../utils/networkUtil.js")),L=t("../../utils/parseUtil.js"),I=t("../../utils/event"),H=(t("../../utils/userBehavior.js"),r()),v={PULL_DOWN_REFRESH_ENABLE:0,PULL_DOWN_REFRESH_DISABLE:1,PULL_DOWN_REFRESH_LOADING:2,LOAD_MORE_REFRESH_ENABLE:3,LOAD_MORE_REFRESH_DISABLE:4,LOAD_MORE_REFRESH_LOADING:5},C=v.PULL_DOWN_REFRESH_ENABLE,y=v.LOAD_MORE_REFRESH_ENABLE;Page({data:{statusesMap:{},currentIndex:0,refresh:!1,winHeight:H.globalData.realWindowHeight,startLoading:!1,hasMoreData:!1,tabs:[{name:"推荐",tag:"推荐",groupId:"102803",containerId:"102803"},{name:"榜单",tag:"榜单",groupId:"1028038999",containerId:"102803_ctg1_8999_-_ctg1_8999_home"},{name:"明星",tag:"明星",groupId:"1028034288",containerId:"102803_ctg1_4288_-_ctg1_4288"},{name:"搞笑",tag:"搞笑",groupId:"1028034388",containerId:"102803_ctg1_4388_-_ctg1_4388"},{name:"综艺",tag:"综艺",groupId:"1028034688",containerId:"102803_ctg1_4688_-_ctg1_4688"},{name:"情感",tag:"情感",groupId:"1028031988",containerId:"102803_ctg1_1988_-_ctg1_1988"},{name:"电影",tag:"电影",groupId:"1028033288",containerId:"102803_ctg1_3288_-_ctg1_3288"},{name:"社会",tag:"社会",groupId:"1028034188",containerId:"102803_ctg1_4188_-_ctg1_4188"},{name:"电视剧",tag:"电视剧",groupId:"1028032488",containerId:"102803_ctg1_2488_-_ctg1_2488"},{name:"音乐",tag:"音乐",groupId:"1028035288",containerId:"102803_ctg1_5288_-_ctg1_5288"},{name:"时尚",tag:"时尚",groupId:"1028034488",containerId:"102803_ctg1_4488_-_ctg1_4488"},{name:"游戏",tag:"游戏",groupId:"1028034888",containerId:"102803_ctg1_4888_-_ctg1_4888"},{name:"数码",tag:"数码",groupId:"1028035088",containerId:"102803_ctg1_5088_-_ctg1_5088"},{name:"旅游",tag:"旅游",groupId:"1028032588",containerId:"102803_ctg1_2588_-_ctg1_2588"},{name:"美妆",tag:"美妆",groupId:"1028031588",containerId:"102803_ctg1_1588_-_ctg1_1588"}],refreshType:"auto",canIUseAnimationfinish:o.canIUse("swiper.bindanimationfinish"),isShowLoginDialog:!1,isAccoutAbnormalDialog:!1,errorType:"",errorMsg:"",showToLoad:!1,showCommentBox:!1,commentBlogId:"",showCanvas:!1,showRepostChoosenToast:!1,repostChoosenToastTop:0,showEntry:!1,placeHolderValue:"",searchShow:!0,feedListInfo:{}},jsData:{statuses:[],maxId:0,groupId:"102803",containerId:"102803",firstIdList:[],focusSinceId:0,focusMaxId:0,getDataFromMainApp:!1,mainAppFocusSinceId:0,mainAppFocusMaxId:0,isFirstRequest:!0,switchingTab:!1,lfid:"",ipTestPkShareInfo:null,remindUnreadTaskHandle:null,newRecommendIndex:1},onLoad:function(t){var e=this;o.setMetaDescription&&o.setMetaDescription({content:"一手明星动态，时下热点事件，搞笑幽默段子微博等你来看。",success:function(t){console.log("设置成功")},fail:function(t){console.log("设置失败"),console.log(t)}}),o.setMetaKeywords&&o.setMetaKeywords({content:"微博, 小程序",success:function(t){console.log("设置成功")},fail:function(t){console.log("设置失败"),console.log(t)}}),o.setDocumentTitle&&o.setDocumentTitle({title:"微博"}),"pk"===t.activity&&H.sensors.track("IPShowFromActivity",{luicode:t.luicode||"",fromUid:t.fromUid||""}),I.on("ipTestPkShareInfo",this,function(t){e.jsData.ipTestPkShareInfo=t||null}),this.changeTab(this.data.currentIndex)},onShow:function(){var t=this,e={isShowLoginDialog:!1},a=this.data.statusesMap[this.data.currentIndex];if(a&&a.statuses){var s=this.data.statusesMap[this.data.currentIndex].statuses,o="statusesMap["+this.data.currentIndex+"]";(0,D.calcData)(s)&&this.setData(_({},o,this.data.statusesMap[this.data.currentIndex]))}this.setData(e),H.sensors.register({fid:this.data.containerId,lfid:""}),w.default.checkUserStatus(function(){T.getDefaultSearchValue(H.globalData.uid,t.getDefaultSearchValueSuccessHandler.bind(t),t.getDefaultSearchValueFailHandler.bind(t))})},onHide:function(){H.sensors.register({lfid:this.jsData.containerId,fid:""})},onPullDownRefresh:function(){if(this.jsData.isFirstRequest=!1,C===v.PULL_DOWN_REFRESH_ENABLE){C=v.PULL_DOWN_REFRESH_LOADING,this.setData({refresh:!0,refreshType:"pulldown"}),H.sensors.track("refresh",{refreshType:"pull"});var t={currentIndex:this.data.currentIndex,groupId:this.jsData.groupId,containerId:this.jsData.containerId,maxId:this.jsData.maxId,refreshType:this.data.refreshType,fid:this.jsData.containerId,lfid:this.jsData.lfid};T.getHotTimeline(t,this.getFeedSuccessHandler.bind(this),this.getFeedFailHandler.bind(this))}},onReachBottom:function(t){this.scrollBottom()},scrollBottom:function(){if(this.jsData.isFirstRequest=!1,!(y!==v.LOAD_MORE_REFRESH_ENABLE||this.data.error||"focus"==this.jsData.groupId&&1==this.data.showToLoad)){y=v.LOAD_MORE_REFRESH_LOADING,H.sensors.track("refresh",{refreshType:"loadmore"}),this.setData({refreshType:"loadmore"});var t={currentIndex:this.data.currentIndex,groupId:this.jsData.groupId,containerId:this.jsData.containerId,maxId:this.jsData.maxId,refreshType:this.data.refreshType,fid:this.jsData.containerId,lfid:this.jsData.lfid};T.getHotTimeline(t,this.getFeedSuccessHandler.bind(this),this.getFeedFailHandler.bind(this))}},shouldAbortFeed:function(t,e){return t!=e},tabIndexChanged:function(t){o.stopPullDownRefresh(),this.changeTab(t.detail.params.currentIndex)},changeTab:function(t){if(o.hideLoading(),this.setData({refreshType:"auto",refresh:!1}),o.pageScrollTo({scrollTop:0}),t>=0&&t<this.data.tabs.length){this.setData({currentIndex:t,hasMoreData:!1});var e=this.data.tabs[t];this.jsData.groupId=e.groupId,this.jsData.lfid=""==this.jsData.lfid&&this.jsData.containerId==e.containerId?"":this.jsData.containerId,this.jsData.containerId=e.containerId,"focus"!=this.jsData.groupId&&1==this.data.showToLoad&&this.setData({showToLoad:!1}),H.sensors.register({fid:e.containerId}),H.sensors.track("flowView"),H.sensors.track("refresh",{refreshType:"clicktab"}),this.data.statusesMap[t]&&this.data.statusesMap[t].statuses||(o.showLoading({title:"加载中"}),this.reloadPageData())}},pullDownFailHandler:function(){o.stopPullDownRefresh(),this.setData({refresh:!1}),o.showToast({title:"网络出错啦",icon:"none",image:"../../static/resources/images/empty_failed.png",duration:2e3})},retryGetFeedSuccessHandler:function(t,e,a){!a.errno||"-100"!=a.errno&&"-200"!=a.errno?a.errno||a.state_code&&0!=a.state_code?(C=v.PULL_DOWN_REFRESH_ENABLE,y=v.LOAD_MORE_REFRESH_ENABLE,"pulldown"==this.data.refreshType?this.pullDownFailHandler():(this.setData({startLoading:!1,error:!0}),o.hideLoading())):this.getFeedSuccessHandler(t,e,a):(C=v.PULL_DOWN_REFRESH_ENABLE,y=v.LOAD_MORE_REFRESH_ENABLE,"pulldown"==this.data.refreshType?this.pullDownFailHandler():(this.setData({startLoading:!1,error:!0}),o.hideLoading()))},getFeedFailHandler:function(t){C=v.PULL_DOWN_REFRESH_ENABLE,y=v.LOAD_MORE_REFRESH_ENABLE,"pulldown"==this.data.refreshType?this.pullDownFailHandler():(this.setData({startLoading:!1,error:!0}),o.hideLoading())},getFeedSuccessHandler:function(t,e,a){var s=this;if(!this.shouldAbortFeed(t,this.data.currentIndex)){if(a.errno&&("-100"==a.errno||"-200"==a.errno))return void w.default.updateUserStatus(function(){var t={currentIndex:s.data.currentIndex,groupId:s.jsData.groupId,containerId:s.jsData.containerId,maxId:s.jsData.maxId,refreshType:s.data.refreshType,fid:s.jsData.containerId,lfid:s.jsData.lfid};T.getHotTimeline(t,s.retryGetFeedSuccessHandler.bind(s),s.getFeedFailHandler.bind(s))});if(a.errno||a.state_code&&0!=a.state_code)return C=v.PULL_DOWN_REFRESH_ENABLE,y=v.LOAD_MORE_REFRESH_ENABLE,void("pulldown"==this.data.refreshType?this.pullDownFailHandler():(this.setData({startLoading:!1,error:!0}),o.hideLoading()));C=v.PULL_DOWN_REFRESH_ENABLE,y=v.LOAD_MORE_REFRESH_ENABLE,this.setData({error:!1,startLoading:!1}),o.hideLoading();var r=L.parseStatuses(a,"fromFeed");this.data.feedListInfo=r,this.saveStatusesWithTabStatus(t,e,r)}},getDefaultSearchValueSuccessHandler:function(t){var e=this;"-100"==t.errno||"-200"==t.errno?w.default.updateUserStatus(function(){T.getDefaultSearchValue(H.globalData.uid,e.retryGetDefaultSearchValueSuccessHandler.bind(e),e.getDefaultSearchValueFailHandler.bind(e))}):t&&t.hotwords&&t.hotwords[0]&&this.setData({placeHolderValue:t.hotwords[0].word?"热搜： "+t.hotwords[0].word:"请输入想要搜索的内容..."})},retryGetDefaultSearchValueSuccessHandler:function(t){"-100"==t.errno||"-200"==t.errno?this.getDefaultSearchValueFailHandler(t):this.getDefaultSearchValueSuccessHandler(t)},getDefaultSearchValueFailHandler:function(t){},reloadPageData:function(){var t=this;this.setData({startLoading:!0,error:!1}),this.jsData.maxId=0,0==this.data.currentIndex&&"auto"==this.data.refreshType&&setTimeout(function(){if(!(0!=t.data.currentIndex||"auto"!=t.data.refreshType||t.data.statusesMap[t.data.currentIndex]&&t.data.statusesMap[t.data.currentIndex].statuses)){var e={currentIndex:t.data.currentIndex,groupId:t.jsData.groupId,containerId:t.jsData.containerId,maxId:t.jsData.maxId,refreshType:t.data.refreshType,fid:t.jsData.containerId,lfid:t.jsData.lfid};T.getHotTimeline(e,t.getFeedSuccessHandler.bind(t),t.getFeedFailHandler.bind(t))}},2e3),w.default.checkUserStatus(function(){var e={currentIndex:t.data.currentIndex,groupId:t.jsData.groupId,containerId:t.jsData.containerId,maxId:t.jsData.maxId,refreshType:t.data.refreshType,fid:t.jsData.containerId,lfid:t.jsData.lfid};T.getHotTimeline(e,t.getFeedSuccessHandler.bind(t),t.getFeedFailHandler.bind(t))})},loadData:function(){"auto"==this.data.refreshType?this.reloadPageData():"pulldown"==this.data.refreshType?(this.setData({error:!1}),this.onPullDownRefresh()):(this.setData({error:!1}),this.scrollBottom())},saveStatusesWithTabStatus:function(t,e,a){if(!this.shouldAbortFeed(t,this.data.currentIndex)){var s=this.data.statusesMap;if(a.statuses&&a.statuses.length>0)if(this.setData({hasMoreData:!0}),"auto"==e){this.jsData.maxId=a.maxId,this.jsData.statuses=a.statuses;var r=a.statuses[0].blogId;this.jsData.firstIdList=r?this.jsData.firstIdList.concat(r):this.jsData.firstIdList;var i=void 0;i=s[t]&&s[t].statuses?s[t].statuses.concat(this.jsData.statuses):this.jsData.statuses,this.setData(_({startLoading:!1},"statusesMap."+t,{statuses:i,scrollTop:0})),o.hideLoading()}else if("pulldown"==e){var n=[];s[t]&&s[t].statuses&&(n=s[t].statuses),this.jsData.statuses=a.statuses.concat(n),this.jsData.maxId=a.maxId,this.jsData.firstIdList=this.jsData.firstIdList.concat(a.statuses[0].blogId),this.setData(_({},"statusesMap."+t,{statuses:this.jsData.statuses,scrollTop:0})),o.stopPullDownRefresh(),this.setData({refresh:!1}),C=v.PULL_DOWN_REFRESH_ENABLE}else if(a.statuses[0].blogId&&-1==this.jsData.firstIdList.indexOf(a.statuses[0].blogId)){var d=[];s[t]&&s[t].statuses&&(d=s[t].statuses),this.jsData.statuses=d.concat(a.statuses),this.jsData.maxId=a.maxId,this.jsData.firstIdList=this.jsData.firstIdList.concat(a.statuses[0].blogId),this.setData(_({},"statusesMap."+t,{statuses:this.jsData.statuses,scrollTop:s[t].scrollTop?s[t].scrollTop:0}))}else this.setData({hasMoreData:!1});else this.setData({startLoading:!1,hasMoreData:!1,refresh:!1}),o.hideLoading()}},beforeSwitchTab:function(t){if(0===t.detail.current&&this.data.currentIndex>1)return void this.setData({currentIndex:this.data.currentIndex});t.detail.current!=this.data.currentIndex&&"touch"===t.detail.source&&(this.jsData.switchingTab=!0,this.setData({currentIndex:t.detail.current}))},switchTab:function(t){var e=this;this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){if(0===t.detail.current&&e.data.currentIndex>1)return void e.changeTab(e.data.currentIndex);(e.jsData.switchingTab||t.detail.current!=e.data.currentIndex&&"touch"===t.detail.source)&&(e.jsData.switchingTab=!1,e.changeTab(t.detail.current))},30)},onShareAppMessage:function(t){if("menu"==t.from||"menu"==t.from.from)return{title:"邀请您使用微博发现新鲜事",content:"看最新资讯就上新浪微博",imageUrl:"https://h5.sinaimg.cn/upload/100/843/2018/11/22/weibo_icon.png",path:"/pages/feed/feed"};var e=t.from.target||t.target,a=e.target.dataset.card;return L.parseShareMessage(a)},goSearchPage:function(){o.navigateTo({url:"/pages/hotSearch/hotSearch?searchValue="+this.data.placeHolderValue.substring(3)})}})}),window.define("pages/index/index",function(t,e,a,s,o,r,i,n,d,h,c,l,u,g,m,p){"use strict";var f=(t("../../utils/checkin"),t("../../utils/loginUtil")),_=function(t){return t&&t.__esModule?t:{default:t}}(f),D=t("../../utils/networkUtil.js"),S=t("../../utils/util.js"),w=t("../../utils/toHome.js"),b=t("../../utils/parseUtil.js"),T=t("../../utils/abtest/abtest.js"),L=(t("../../utils/userBehavior"),t("../../utils/event.js"));S.init();var I=r(),H=0;Page({data:{commentList:[],status:null,max_id:0,show_loadmore:!0,start_loading:!0,error:!1,error_content:null,show_toggle:!1,show_img:[],blog_id:"",shareImgPath:"",show_bottom_share:!1,showCanvas:!0,max_id_type:0,loadDataFlag:!0,showLaunchApp:!1,showToHome:!1,likeStatus:!1,originAttitudesCount:0,attitudesCount:0,tempLikeStatus:!1,showPullDown:!1,trendsLeft:[],trendsRight:[],trendsLeftHeight:0,trendsRightHeight:0,showMoreComment:!1,commentDetailList:[],trendExt:0,trendMaxId:0,showTrend:-1,trendExpoId:"",trendShowStartTime:"",trendShowEndTime:"",trendLeftHeightArr:[],trendRightHeightArr:[],maxScrollHeight:0,heightWater:0,heightAll:0,heightContent:0,trendShowStartFlag:!0,fromTrend:!1,hasDelete:!1,networkAvailable:!0,isShowLoginDialog:!1,isBirthCard:!0,isAccoutAbnormalDialog:!1,errorType:"",errorMsg:"",gotUserInfo:!1,showCommentBox:!1,targetCommentId:0,targetMid:0,showFakeData:!1,fakeData:{},isReply:"index",placeholder:"写评论",commentId:0,showRepostChoosenToast:!1,repostChoosenToastTop:0,showEntry:!1,placeHolderValue:"",searchExperiment:!0,showTab:!0,videoReady:!1,options:"",indexScheme:"",getStatusFrom:""},onUnload:function(){this.trackTrendExposure(),this.setData({loadDataFlag:!1}),this.clearData(),I.sensors.register({mid:""})},onShow:function(t){this.setData({showToHome:I.globalData.showToHome});getCurrentPages();I.globalData.newLogin&&(this.loadData(this.data.options),I.globalData.newLogin=!1),this.data.fromTrend&&I.sensors.register({detailViewSource:"trend"}),0==this.data.heightAll&&this.getContentHeight()},onLoad:function(t){var e=this;o.setMetaDescription&&o.setMetaDescription({content:"一手明星动态，时下热点事件，搞笑幽默段子微博等你来看。",success:function(t){console.log("设置成功")},fail:function(t){console.log("设置失败"),console.log(t)}}),o.setMetaKeywords&&o.setMetaKeywords({content:"微博, 小程序",success:function(t){console.log("设置成功")},fail:function(t){console.log("设置失败"),console.log(t)}}),o.setDocumentTitle&&o.setDocumentTitle({title:"微博"}),o.showLoading({title:"加载中"}),L.on("hideIndexTab",this,function(t){e.data.blog_id===t&&e.setData({showTab:!1})}),L.on("showIndexTab",this,function(t){e.data.blog_id===t&&e.setData({showTab:!0})}),this.setData({gotUserInfo:I.globalData.gotUserInfo,loadDataFlag:!0,searchExperiment:"topSearch"===T.getABTestBucket("searchExperiment")}),this.data.options=t,this.data.fromTrend="true"===t.from_trend,this.loadData(t)},onHide:function(){this.trackTrendExposure(),this.data.fromTrend&&I.sensors.register({detailViewSource:""})},trackTrendExposure:function(){if(""!=this.data.trendShowStartTime){this.data.trendShowEndTime=this.data.trendShowEndTime?this.data.trendShowEndTime:Date.parse(new Date);var t=750*this.data.maxScrollHeight/I.globalData.windowWidth,e=this.getShowTrendCardDetail(this.data.trendLeftHeightArr,t,this,"left"),a=this.getShowTrendCardDetail(this.data.trendRightHeightArr,t,this,"right"),s=e.num+a.num,o=e.midArr.concat(a.midArr);s>0&&I.sensors.track("trendContentExposure",{trendShowStartTime:this.data.trendShowStartTime,trendShowEndTime:this.data.trendShowEndTime,trendShowNumber:s,trendShowMID:o,trendExpoId:this.data.trendExpoId})}this.data.trendsLeftHeight=0,this.data.trendsRightHeight=0,this.data.trendShowStartTime="",this.data.trendShowEndTime="",this.data.trendLeftHeightArr=[],this.data.trendRightHeightArr=[],this.data.maxScrollHeight=0,this.data.heightWater=0,this.data.heightAll=0,this.data.heightContent=0},onPageScroll:function(t){var e=t.scrollTop+I.globalData.windowHeight,a=1==this.data.show_toggle?40:0;t.scrollTop>H&&(H=t.scrollTop),this.data.maxScrollHeight=H+I.globalData.windowHeight+a-56-this.data.heightContent;var s=750*(this.data.heightContent-e),o=I.globalData.windowWidth;parseInt(s/o,10)<20&&this.data.trendShowStartFlag&&0!=this.data.heightWater&&(this.data.trendShowStartTime=Date.parse(new Date),this.data.trendShowStartFlag=!1),H>t.scrollTop&&this.data.trendShowStartTime&&e<=this.data.heightContent&&!this.data.trendShowEndTime&&(this.data.trendShowEndTime=Date.parse(new Date))},clearData:function(){this.setData({commentList:[],status:null,max_id:0,show_loadmore:!0,start_loading:!0,error:!1,error_content:null,show_toggle:!1,show_img:[],blog_id:"",shareImgPath:"",show_bottom_share:!1,showCanvas:!0,max_id_type:0,hasDelete:!1,networkAvailable:!0,videoReady:!1,showTab:!0,indexScheme:"",getStatusFrom:""})},loadData:function(t){var e=this;if(t&&!t.blog_id&&(this.data.blog_id="4249456083411688"),t&&t.scene){var a=decodeURIComponent(t.scene),s=S.getUrlParam(a,"blog_id");""!=s&&(this.data.blog_id=s)}this.data.blog_id||(this.data.blog_id=t.blog_id),this.setData({indexScheme:"sinaweibo://detail/?mblogid="+this.data.blog_id+"&luicode=10000360&lfid=miniprogram"}),t&&t.index&&(this.data.index=t.index),this.data.start_loading||this.setData({start_loading:!0}),!this.data.error&&this.data.networkAvailable||this.setData({error:!1,networkAvailable:!0}),I.sensors.register({mid:this.data.blog_id?this.data.blog_id.toString():""}),I.sensors.track("detailView"),_.default.checkUserStatus(function(){D.getComments({blog_id:e.data.blog_id,max_id:e.data.max_id,max_id_type:e.data.max_id_type},e.getCommentsSuccessHandler.bind(e),e.getCommentsFailHandler.bind(e),e.getCommentsCompleteHandler.bind(e)),D.getTrend(e.data.blog_id,e.getTrendSuccessHandler.bind(e),e.getTrendFailHandler.bind(e),e.getTrendCompleteHandler.bind(e)),D.getDefaultSearchValue(I.globalData.uid,e.getDefaultSearchValueSuccessHandler.bind(e),e.getDefaultSearchValueFailHandler.bind(e))})},loadMore:function(t){(this.data.showTrend||this.data.show_loadmore)&&(-1!=this.data.showTrend&&this.data.showTrend?(I.sensors.track("refresh",{refreshType:"loadmore",isRecom:!0}),D.getMoreTrend(this.data.blog_id,this.data.trendMaxId,this.data.trendExt,this.getTrendSuccessHandler.bind(this),this.getTrendFailHandler.bind(this),this.getTrendCompleteHandler.bind(this))):(I.sensors.track("refresh",{refreshType:"loadmore",isRecom:!1}),D.getComments({blog_id:this.data.blog_id,max_id:this.data.max_id,max_id_type:this.data.max_id_type},this.getCommentsSuccessHandler.bind(this),this.getCommentsFailHandler.bind(this),this.getCommentsCompleteHandler.bind(this))))},reload:function(){this.setData({loadDataFlag:!0}),this.loadData()},toggleMore:function(){var t=new Array(this.data.status.mediaContent.showImgList.length);t.fill({show:!0}),this.setData({show_toggle:!1,"status.mediaContent.showImgList":t}),I.sensors.track("contentClick",{clickType:"more"}),this.getContentHeight()},forCatch:function(){},goToCommentSecPage:function(){I.sensors.track("commentSecPageClick"),o.navigateTo({url:"/pages/CommentDetail/CommentDetail?comment_id="+this.data.blog_id+"&fromIndex=true"})},toHome:function(){w.toHome()},onReachBottom:function(){this.loadMore()},onShareAppMessage:function(t){if(this.data.status){var e=this.data.status.retweetedStatus||this.data.status;return b.parseShareMessage(e)}return{}},drawShareImageHandler:function(){this.setData({showCanvas:!1})},getTrendSuccessHandler:function(t){var e=this,a=t.data;if(!a||"-100"!=a.errno&&"-200"!=a.errno){if(!a||a.errno)return}else _.default.updateUserStatus(function(){D.getTrend(e.data.blog_id,e.retryGetTrendSuccessHandler.bind(e),e.getTrendFailHandler.bind(e),e.getTrendCompleteHandler.bind(e))});var s=b.parseTrend(a,this.data.trendsLeftHeight,this.data.trendsRightHeight,this.data.trendLeftHeightArr,this.data.trendRightHeightArr),o=s.trendType,r=s.trendsLeft,i=s.trendsRight;this.data.trendExpoId=this.data.trendExpoId||s.trendExpoId,this.data.trendsLeftHeight=s.trendsLeftHeight,this.data.trendsRightHeight=s.trendsRightHeight,this.data.trendLeftHeightArr=s.trendLeftHeightArr,this.data.trendRightHeightArr=s.trendRightHeightArr,T.setTrendExperiment(s.trendExpId),r.length>0?(this.data.trendExt=0==s.trendExt?this.data.trendExt:s.trendExt,this.data.trendMaxId=s.maxId,r.length>0&&this.setData({showPullDown:!0}),"loadMore"!=o?(this.data.showTrend=!0,this.data.trendsLeft=r,this.data.trendsRight=i):(this.data.trendsLeft=this.data.trendsLeft.concat(r),this.data.trendsRight=this.data.trendsRight.concat(i))):-1==this.data.showTrend&&(this.data.showTrend=!1)},retryGetTrendSuccessHandler:function(t){var e=t.data;e.errno||this.getTrendSuccessHandler(e)},getTrendFailHandler:function(t){this.data.showTrend=!1},getTrendCompleteHandler:function(){this.data.start_loading=!1,this.uploadTrend()},getCommentsCompleteHandler:function(){this.data.start_loading=!1,this.uploadComment()},retryGetCommentsSuccessHandler:function(t){return"-100"==t.errno||"-200"==t.errno?void this.setData({error:!0,error_content:null}):t.errno||0!=t.state_code?void this.setData({error:!0}):void(t.errno&&"1040002"==t.errno?this.setData({error:!0,error_content:null,networkAvailable:!1}):this.getCommentsSuccessHandler(t))},getCommentsSuccessHandler:function(t){var e=this;if(this.data.loadDataFlag){if("-100"==t.errno||"-200"==t.errno)return void _.default.updateUserStatus(function(){D.getComments({blog_id:e.data.blog_id,max_id:e.data.max_id,max_id_type:e.data.max_id_type},e.retryGetCommentsSuccessHandler.bind(e),e.getCommentsFailHandler.bind(e),e.getCommentsCompleteHandler.bind(e))});if(t.status&&t.status.mblogtypename&&null==t.status.mblogtypename)return this.setData({error:""!=this.data.getStatusFrom,needLogin:0==I.globalData.userStatus,getStatusFrom:"statuses/show"}),void D.getStatus(this.data.blog_id,this.getCommentsSuccessHandler.bind(this),this.getCommentsFailHandler.bind(this),this.getCommentsCompleteHandler.bind(this));if(t.errno||0!=t.state_code)return this.setData({error:""!=this.data.getStatusFrom,needLogin:0==I.globalData.userStatus,getStatusFrom:"statuses/show"}),void D.getStatus(this.data.blog_id,this.getCommentsSuccessHandler.bind(this),this.getCommentsFailHandler.bind(this),this.getCommentsCompleteHandler.bind(this));if(t.errno&&"1040002"==t.errno)return void this.setData({error:!0,error_content:null,networkAvailable:!1});if(t&&t.errno&&("20112"==t.errno||"20174"==t.errno))return void this.setData({error:!0,error_content:"暂无查看权限",networkAvailable:!0,hasDelete:!0});if(t&&t.errno&&"20101"==t.errno)return void this.setData({error:!0,error_content:t.errmsg,networkAvailable:!0,hasDelete:!0});if(t.status&&t.status.isLongText&&"true"==t.status.isLongText&&(this.data.show_toggle=!0),-1!=this.data.showTrend&&(this.data.start_loading=!1),null==this.data.status&&t.status){if(0!=t.status.mblog_vip_type||t.status.retweeted_status&&t.status.retweeted_status.mblog_vip_type&&0!=t.status.retweeted_status.mblog_vip_type)return void this.setData({error:!0,error_content:"打开微博客户端，查看全文"});1==t.status.attitudes_status&&(this.data.likeStatus=!0,this.data.tempLikeStatus=!0);var a=b.parseStatus(t.status,!!t.status.retweeted_status,!1),s=new Date,o=s.getFullYear();new Date(t.status.created_at).format("yyyy")==o?a.createdAt=new Date(t.status.created_at).format("MM-dd hh:mm"):a.createdAt=new Date(t.status.created_at).format("yyyy-MM-dd hh:mm"),1==a.showToggleImg&&"video"!=a.mediaContent.mediaType&&(this.data.show_toggle=!0),this.data.error=!1,this.data.status=a,this.data.originAttitudesCount=a.originAttitudesCount,this.data.attitudesCount=a.attitudesCount;var r=this.data.status.mediaContent;if("video"!=a.mediaContent.mediaType)for(var i=0;i<r.showImgList.length;i++)if(!r.showImgList[i].show){this.data.show_toggle=!0,r.showImgList[i]={show:!0};break}var n=this.data.status.retweetedStatus;if(null!=n||n)for(var d=n.mediaContent,h=0;h<d.showImgList.length;h++)if(!d.showImgList[h].show&&"video"!=n.mediaContent.mediaType){this.data.show_toggle=!0,d.showImgList[h]={show:!0};break}var c=this.data.status;c.mediaContent=r,this.data.status=c,"webPage"===c.mediaContent.mediaType&&(this.data.isBirthCard=!1)}var l=!0;if(!t.datas&&t.root_comments&&t.root_comments.length>0&&(t.datas=t.root_comments,l=!1),this.data.show_loadmore=0!=t.max_id&&!!t.datas&&t.datas.length>0,t.datas&&t.datas.length>0){var u=[];t.datas.forEach(function(e,a,s){var o=0;if(l&&(o=e.type,e=e.data),0==o){t.status&&t.status.number_display_strategy&&!e.number_display_strategy&&(e.number_display_strategy=t.status.number_display_strategy);var r=b.parseComment(e);u.push(r)}});var g=u;g.length>3&&(g=g.slice(0,3)),this.data.commentDetailList=this.data.commentDetailList.concat(u),this.data.commentList=this.data.commentList.concat(g),this.data.showMoreComment=this.data.commentDetailList.length>g.length}this.data.max_id=t.max_id?t.max_id:0,this.data.max_id_type=t.max_id_type?t.max_id_type:0}},getCommentsFailHandler:function(t){this.setData({error:!0,error_content:t.errMsg,networkAvailable:!1})},uploadTrend:function(){this.setData({start_loading:this.data.start_loading,trendsLeft:this.data.trendsLeft,trendsRight:this.data.trendsRight,trendExpoId:this.data.trendExpoId,trendExt:this.data.trendExt,trendMaxId:this.data.trendMaxId,showTrend:this.data.showTrend}),o.hideLoading(),this.getContentHeight()},getContentHeight:function(){var t=this;o.createSelectorQuery().select("#main").boundingClientRect(function(e){e&&(t.data.heightAll=e.height),o.createSelectorQuery().select("#water-flow").boundingClientRect(function(e){e&&(t.data.heightWater=e.height,t.data.heightContent=t.data.heightAll-t.data.heightWater)}).exec()}).exec()},getShowTrendCardDetail:function(t,e,a,s){for(var o=[],r=0;r<t.length-1;r++)if("left"==s?o.push(a.data.trendsLeft[r].mid):o.push(a.data.trendsRight[r].mid),t[r]<=e&&t[r+1]>=e)return{num:r+1,midArr:o};return{num:0,midArr:[]}},loadAd:function(){I.sensors.track("adImpression")},adError:function(t){t&&t.detail&&t.detail.errCode&&I.sensors.track("adError",{errorCode:t.detail.errCode,errorMessage:t.detail.errMsg})},uploadComment:function(){this.setData({commentList:this.data.commentList,status:this.data.status,max_id:this.data.max_id,show_loadmore:this.data.show_loadmore,error:this.data.error,error_content:this.data.error_content,show_toggle:this.data.show_toggle,show_img:this.data.show_img,blog_id:this.data.blog_id,shareImgPath:this.data.shareImgPath,show_bottom_share:this.data.show_bottom_share,showCanvas:this.data.showCanvas,max_id_type:this.data.max_id_type,loadDataFlag:this.data.loadDataFlag,showLaunchApp:this.data.showLaunchApp,showToHome:this.data.showToHome,likeStatus:this.data.likeStatus,originAttitudesCount:this.data.originAttitudesCount,attitudesCount:this.data.attitudesCount,tempLikeStatus:this.data.tempLikeStatus,showPullDown:this.data.showPullDown,showMoreComment:this.data.showMoreComment,commentDetailList:this.data.commentDetailList,showTrend:this.data.showTrend,isBirthCard:this.data.isBirthCard}),o.hideLoading()},showCommentDialog:function(t){t.detail.params.from&&"indexReply"==t.detail.params.from?this.setData({showCommentBox:t.detail.params.showCommentBox,isReply:"indexReply",placeholder:t.detail.params.replyName?"回复@"+t.detail.params.replyName:"回复评论",targetCommentId:t.detail.params.targetCommentId,targetMid:t.detail.params.targetMid,commentId:t.detail.params.commentId}):this.setData({showCommentBox:t.detail.params.showCommentBox,isReply:"index",placeholder:"写评论",targetCommentId:this.data.blog_id})},showFakeData:function(t){var e=t.detail.params.fakeData;"index"==this.data.isReply?(this.data.commentList.unshift(e),this.data.commentDetailList.unshift(e),this.setData({commentList:this.data.commentList,commentDetailList:this.data.commentDetailList})):this.setData({showFakeData:!this.data.showFakeData,fakeData:e})},getDefaultSearchValueSuccessHandler:function(t){var e=this;"-100"==t.errno||"-200"==t.errno?_.default.updateUserStatus(function(){D.getDefaultSearchValue(I.globalData.uid,e.retryGetDefaultSearchValueSuccessHandler.bind(e),e.getDefaultSearchValueFailHandler.bind(e))}):t&&t.hotwords&&t.hotwords[0]&&this.setData({placeHolderValue:t.hotwords[0].word?"热搜： "+t.hotwords[0].word:"请输入想要搜索的内容..."})},retryGetDefaultSearchValueSuccessHandler:function(t){"-100"==t.errno||"-200"==t.errno?this.getDefaultSearchValueFailHandler.bind(this):this.getDefaultSearchValueSuccessHandler.bind(this)},getDefaultSearchValueFailHandler:function(t){},loadDom:function(t){this.setData({videoReady:!0})},showTips:function(){o.showModal({content:"小程序暂时不支持此功能哦",showCancel:!1})}})}),window.define("pages/CommentDetail/CommentDetail",function(t,e,a,s,o,r,i,n,d,h,c,l,u,g,m,p){"use strict";var f=t("../../utils/loginUtil"),_=function(t){return t&&t.__esModule?t:{default:t}}(f),D=t("../../utils/networkUtil.js"),S=t("../../utils/util.js"),w=t("../../utils/parseUtil.js"),b=r();S.init(),Page({data:{root_comment:{},commentList:[],max_id:0,show_loadmore:!0,start_loading:!0,comment_id:"",max_id_type:0,isShowLoginDialog:!1,isAccoutAbnormalDialog:!1,errorType:"",errorMsg:"",fromIndex:!1,mid:"",showCommentBox:!1,targetCommentId:"",targetMid:"",contentHeight:b.globalData.realWindowHeight,replyName:"",fromMsg:!1},onLoad:function(t){o.setMetaDescription&&o.setMetaDescription({content:"一手明星动态，时下热点事件，搞笑幽默段子微博等你来看。",success:function(t){console.log("设置成功")},fail:function(t){console.log("设置失败"),console.log(t)}}),o.setMetaKeywords&&o.setMetaKeywords({content:"微博, 小程序",success:function(t){console.log("设置成功")},fail:function(t){console.log("设置失败"),console.log(t)}}),o.setDocumentTitle&&o.setDocumentTitle({title:"微博"}),t.mid&&this.setData({mid:t.mid}),t.fromMsg&&this.setData({fromMsg:!0}),t.fromIndex?this.setData({start_loading:!0,fromIndex:t.fromIndex,comment_id:t.comment_id}):this.setData({comment_id:t.comment_id}),o.showLoading({title:"加载中"}),this.loadMore()},onShow:function(){this.setData({isShowLoginDialog:!1})},onReachBottom:function(){this.loadMore()},loadMore:function(){if(this.data.show_loadmore){this.data.show_loadmore=!1,b.sensors.track("refresh",{refreshType:"loadmore"});var t={blog_id:this.data.comment_id,max_id:this.data.max_id,max_id_type:this.data.max_id_type,fetch_level:this.data.fromIndex?0:1};console.log(t),D.getComments(t,this.getCommentsSuccessHandler.bind(this),this.getCommentsFailHandler.bind(this))}},retryGetCommentsSuccessHandler:function(t){this.data.start_loading&&this.setData({start_loading:!1}),!t||"-100"!=t.errno&&"-200"!=t.errno?this.getCommentsSuccessHandler(t):this.getCommentsFailHandler(t)},getCommentsSuccessHandler:function(t){var e=this;if(this.data.start_loading&&this.setData({start_loading:!1}),t&&("-100"==t.errno||"-200"==t.errno))return this.setData({show_loadmore:!0}),void _.default.updateUserStatus(function(){var t={blog_id:e.data.comment_id,max_id:e.data.max_id,max_id_type:e.data.max_id_type,fetch_level:e.data.fromIndex?0:1};D.getComments(t,e.getCommentsSuccessHandler.bind(e),e.getCommentsFailHandler.bind(e))});if(this.setData({show_loadmore:0!=t.max_id}),this.data.fromMsg&&(!t||t.state_code&&0!=t.state_code))return o.showToast({title:"抱歉，此评论已被删除",icon:"none",duration:1500,mask:!0}),void setTimeout(function(){o.navigateBack({delta:1})},1500);if(!this.data.fromIndex&&void 0!=t.rootComment){var a=t.rootComment;t.status&&t.status.number_display_strategy&&!a.number_display_strategy&&(a.number_display_strategy=t.status.number_display_strategy);var s=w.parseStatus(a,!(void 0==a.retweeted_status),!1),r={id:a.id.toString(),time:new Date(a.created_at).format("MM-dd hh:mm"),content:a.text,cardContentList:s.cardContentList,like_status:a.liked,origin_like_counts:a.like_counts,like_counts:a.attitudesCount,uid:a.user.id,name:a.user.screen_name,head_img:a.user.profile_image_url};this.setData({root_comment:r}),o.hideLoading()}this.data.fromIndex&&void 0==t.datas&&void 0!=t.root_comments&&t.root_comments.length>0&&(t.datas=t.root_comments);var i=this.data.fromIndex?t.datas:t.comments;if(void 0!=i&&i.length>0){for(var n=[],d=0;d<i.length;d++){var h=i[d],c=void 0==h.data?h:h.data;if(!this.data.fromIndex||this.data.fromIndex&&void 0==h.type||this.data.fromIndex&&void 0!=h.type&&0==h.type){t.status&&t.status.number_display_strategy&&!c.number_display_strategy&&(c.number_display_strategy=t.status.number_display_strategy);var l=w.parseComment(c);n[d]=l}}this.setData({commentList:this.data.commentList.concat(n)}),o.hideLoading()}this.setData({max_id:t.max_id,max_id_type:void 0==t.max_id_type?0:t.max_id_type})},getCommentsFailHandler:function(t){o.hideLoading(),this.setData({show_loadmore:!0})},showFakeData:function(t){var e=t.detail.params.fakeData;if(this.data.root_comment&&this.data.root_comment.id==this.data.targetCommentId)this.data.commentList.unshift(e),this.setData({commentList:this.data.commentList});else for(var a=0;a<this.data.commentList.length;a++)if(this.data.commentList[a].id==this.data.targetCommentId){this.data.fromIndex?(this.data.commentList[a].comments?this.data.commentList[a].comments.unshift(e):this.data.commentList[a].comments=[e],this.data.commentList[a].more=!0):this.data.commentList.unshift(e),this.setData({commentList:this.data.commentList});break}}})}),window.define("pages/profile/profile",function(t,e,a,s,o,r,i,n,d,h,c,l,u,g,m,p){"use strict";var f=t("../../store/index"),_=t("../../utils/checkin"),D=t("../../utils/loginUtil"),S=function(t){return t&&t.__esModule?t:{default:t}}(D),w=t("../../utils/networkUtil.js"),b=t("../../utils/userUtil.js"),T=(t("../../utils/util.js"),t("../../utils/event.js"),t("../../utils/parseUtil.js")),L=(t("../../utils/abtest/abtest.js"),r());Page({data:{page:1,userInfo:{},feedInfo:[],hasMoreData:!0,loadTag:!1,nickName:"",error:!1,startLoading:!1,refreshType:"auto",loadProfileError:!1,showFollow:!0,showloading:!1,animationData:{},rotateIndex:0,notExist:!1,uid:0,isAccoutAbnormalDialog:!1,errorType:"",errorMsg:"",isShowLoginDialog:!1,gotUserInfo:!1,showCommentBox:!1,commentBlogId:0,contentHeight:L.globalData.realWindowHeight,showRepostChoosenToast:!1,repostChoosenToastTop:0,showEntry:!1,profileScheme:"",showToHome:!1},shareImgPath:"",onLoad:function(t){o.setMetaDescription&&o.setMetaDescription({content:"一手明星动态，时下热点事件，搞笑幽默段子微博等你来看。",success:function(t){console.log("设置成功")},fail:function(t){console.log("设置失败"),console.log(t)}}),o.setMetaKeywords&&o.setMetaKeywords({content:"微博, 小程序",success:function(t){console.log("设置成功")},fail:function(t){console.log("设置失败"),console.log(t)}}),o.setDocumentTitle&&o.setDocumentTitle({title:"微博"}),this.setData({nickName:decodeURI(t.nickname),loadTag:!L.globalData.gotUserInfo,uid:t.uid||L.globalData.uid,profileScheme:"sinaweibo://userinfo?luicode=10000360&lfid=miniprogram&nick="+decodeURI(t.nickname)}),L.sensors.track("detailView",{objectUid:t.objectUid?t.objectUid.toString():"",luicode:t.luicode?t.luicode.toString():""}),o.showLoading({title:"加载中"}),this.loadData(),this.animation=o.createAnimation({duration:2e3,timingFunction:"linear"})},loadData:function(){var t=this;if(this.setData({startLoading:!0,error:!1}),"auto"==this.data.refreshType){var e={nickname:this.data.nickName,uid:this.data.uid};setTimeout(function(){0==Object.keys(t.data.userInfo).length&&w.getUserProfile(e,t.getUserInfoSuccessHandler.bind(t),t.getUserInfoFailHandler.bind(t))},1e3),S.default.checkUserStatus(function(){w.getUserProfile(e,t.getUserInfoSuccessHandler.bind(t),t.getUserInfoFailHandler.bind(t))})}},onShow:function(){var t=this.data.feedInfo,e={isShowLoginDialog:!1,loadTag:0==L.globalData.userStatus,gotUserInfo:L.globalData.gotUserInfo,showToHome:L.globalData.showToHome};if(_.condition.call(this,e),t.length){var a=(0,f.calcData)(t);a&&this.setData({statuses:a})}this.setData(e),1==L.globalData.userStatus&&0==this.data.startLoading&&this.onReachBottom()},loadProfileTimeline:function(){this.setData({loadProfileError:!1}),"auto"==this.data.refreshType?w.getProfileTimeline(this.data.userInfo.id,this.data.page,this.getProfileTimelineSuccessHandler.bind(this),this.getProfileTimelineFailHandler.bind(this)):this.onReachBottom()},onReachBottom:function(){L.sensors.track("refresh",{refreshType:"loadmore"}),this.data.error||this.data.loadProfileError||(L.sensors.track("refresh",{refreshType:"loadmore"}),this.setData({refreshType:"loadmore"}),0!=this.data.feedInfo.length&&this.data.userInfo&&(this.setData({hasMoreData:!0}),this.data.page=this.data.page+1,w.getProfileTimeline(this.data.userInfo.id,this.data.page,this.getProfileTimelineSuccessHandler.bind(this),this.getProfileTimelineFailHandler.bind(this))))},onShareAppMessage:function(t){if("menu"==t.from||"menu"==t.from.from)return{title:"分享"+this.data.userInfo.name+"的 个人主页",content:"粉丝数: "+this.data.userInfo.followersCount,imageUrl:this.data.userInfo.avatar,path:"/pages/profile/profile?nickname="+encodeURIComponent(this.data.userInfo.name)};var e=t.from.target||t.target,a=e.target.dataset.card;return T.parseShareMessage(a)},previewImage:function(t){var e=[];e.push(t.target.dataset.src),o.previewImage({current:t.target.dataset.src,urls:e})},getUserInfoSuccessHandler:function(t){var e=this;if(!t||"-100"!=t.errno&&"-200"!=t.errno)!t||"20003"!=t.errno&&"20034"!=t.errno?t&&t.errno||t.state_code&&0!=t.state_code?(this.setData({startLoading:!1,error:!0}),o.hideLoading()):(this.setData({startLoading:!1,userInfo:b.parseProfile(this.data.nickName,t.data)}),o.hideLoading(),w.getProfileTimeline(this.data.userInfo.id,this.data.page,this.getProfileTimelineSuccessHandler.bind(this),this.getProfileTimelineFailHandler.bind(this))):(this.setData({notExist:!0,startLoading:!1,userInfo:b.parseProfile(this.data.nickName,t.data)}),o.hideLoading());else{var a={nickname:this.data.nickName,uid:this.data.uid};S.default.updateUserStatus(function(){w.getUserProfile(a,e.retryGetUserInfoSuccessHandler.bind(e),e.getUserInfoFailHandler.bind(e))})}},retryGetUserInfoSuccessHandler:function(t){!t||"-100"!=t.errno&&"-200"!=t.errno?this.getUserInfoSuccessHandler(t):this.getUserInfoFailHandler()},getUserInfoFailHandler:function(t){this.setData({startLoading:!1,error:!0}),o.hideLoading()},forCatch:function(){},retryGetProfileTimelineSuccessHandler:function(t){t&&t.data&&("-100"==t.data.errno||"-200"==t.data.errno)?this.setData({loadProfileError:!0}):this.getProfileTimelineSuccessHandler(t)},getProfileTimelineSuccessHandler:function(t){var e=this;if(t&&t.data&&("-100"==t.data.errno||"-200"==t.data.errno))S.default.updateUserStatus(function(){w.getProfileTimeline(e.data.userInfo.id,e.data.page,e.retryGetProfileTimelineSuccessHandler.bind(e),e.getProfileTimelineFailHandler.bind(e))});else if(t&&t.errno||t.state_code&&0!=t.state_code)this.setData({loadProfileError:!0});else{var a=b.parseProfileTimeline(t);if("auto"==this.data.refreshType)this.setData({feedInfo:a.statuses,hasMoreData:a.statuses.length>=3});else{if(0==a.statuses.length)return void this.setData({hasMoreData:!1});this.setData({hasMoreData:!1,feedInfo:this.data.feedInfo.concat(a.statuses)})}}},getProfileTimelineFailHandler:function(t){this.setData({loadProfileError:!0})},toSelfFollowed:function(){o.navigateTo({url:"/pages/SelfFollowed/SelfFollowed?from=followed"})},toSelfFans:function(){o.navigateTo({url:"/pages/SelfFollowed/SelfFollowed?from=fans"})}})}),window.define("pages/hotSearch/hotSearch",function(t,e,a,s,o,r,i,n,d,h,c,l,u,g,m,p){"use strict";var f=t("../../store/index"),_=t("../../utils/loginUtil"),D=function(t){return t&&t.__esModule?t:{default:t}}(_),S=t("../../utils/networkUtil.js"),w=t("../../utils/parseUtil.js"),b=t("../../utils/util.js"),T=(t("../../utils/event.js"),t("../../utils/userBehavior.js"),r());Page({data:{top:T.globalData.totalTopHeight,navigationTitle:"热搜",pageHotList:!0,pageSearchResult:!1,isFocus:!0,startLoading:!0,error:!1,title:"",hotListCards:[],searchValue:"",hotSearchNumber:"",searchType:"",showDelete:!1,placeholder:"请输入想要搜索的内容...",imageList:["../../static/resources/images/hot_search/hotsearch_top.png","../../static/resources/images/hot_search/hotsearch_number_1.png","../../static/resources/images/hot_search/hotsearch_number_2.png","../../static/resources/images/hot_search/hotsearch_number_3.png","../../static/resources/images/hot_search/hotsearch_number_4.png","../../static/resources/images/hot_search/hotsearch_number_5.png","../../static/resources/images/hot_search/hotsearch_number_6.png","../../static/resources/images/hot_search/hotsearch_number_7.png","../../static/resources/images/hot_search/hotsearch_number_8.png","../../static/resources/images/hot_search/hotsearch_number_9.png","../../static/resources/images/hot_search/hotsearch_number_10.png","../../static/resources/images/hot_search/hotsearch_number_11.png","../../static/resources/images/hot_search/hotsearch_number_12.png","../../static/resources/images/hot_search/hotsearch_number_13.png","../../static/resources/images/hot_search/hotsearch_number_14.png","../../static/resources/images/hot_search/hotsearch_number_15.png","../../static/resources/images/hot_search/hotsearch_number_16.png","../../static/resources/images/hot_search/hotsearch_number_17.png","../../static/resources/images/hot_search/hotsearch_number_18.png","../../static/resources/images/hot_search/hotsearch_number_19.png","../../static/resources/images/hot_search/hotsearch_number_20.png","../../static/resources/images/hot_search/hotsearch_number_21.png","../../static/resources/images/hot_search/hotsearch_number_22.png","../../static/resources/images/hot_search/hotsearch_number_23.png","../../static/resources/images/hot_search/hotsearch_number_24.png","../../static/resources/images/hot_search/hotsearch_number_25.png","../../static/resources/images/hot_search/hotsearch_number_26.png","../../static/resources/images/hot_search/hotsearch_number_27.png","../../static/resources/images/hot_search/hotsearch_number_28.png","../../static/resources/images/hot_search/hotsearch_number_29.png","../../static/resources/images/hot_search/hotsearch_number_30.png","../../static/resources/images/hot_search/hotsearch_number_31.png","../../static/resources/images/hot_search/hotsearch_number_32.png","../../static/resources/images/hot_search/hotsearch_number_33.png","../../static/resources/images/hot_search/hotsearch_number_34.png","../../static/resources/images/hot_search/hotsearch_number_35.png","../../static/resources/images/hot_search/hotsearch_number_36.png","../../static/resources/images/hot_search/hotsearch_number_37.png","../../static/resources/images/hot_search/hotsearch_number_38.png","../../static/resources/images/hot_search/hotsearch_number_39.png","../../static/resources/images/hot_search/hotsearch_number_40.png","../../static/resources/images/hot_search/hotsearch_number_41.png","../../static/resources/images/hot_search/hotsearch_number_42.png","../../static/resources/images/hot_search/hotsearch_number_43.png","../../static/resources/images/hot_search/hotsearch_number_44.png","../../static/resources/images/hot_search/hotsearch_number_45.png","../../static/resources/images/hot_search/hotsearch_number_46.png","../../static/resources/images/hot_search/hotsearch_number_47.png","../../static/resources/images/hot_search/hotsearch_number_48.png","../../static/resources/images/hot_search/hotsearch_number_49.png","../../static/resources/images/hot_search/hotsearch_number_50.png"],statuses:[],userList:[],pageUserList:[],userLength:0,page:1,userPage:1,hasMoreData:!0,hasMoreUser:!1,errMsg:"",needLogin:0==T.globalData.userStatus,returnErrorCode:"",contentSet:"",isShowLoginDialog:!1,isAccoutAbnormalDialog:!1,errorType:"",errorMsg:"",networkAvailable:!0,showCommentBox:!1,commentBlogId:0,contentHeight:T.globalData.realWindowHeight,showRepostChoosenToast:!1,repostChoosenToastTop:0},onLoad:function(t){o.setMetaDescription&&o.setMetaDescription({content:"一手明星动态，时下热点事件，搞笑幽默段子微博等你来看。",success:function(t){console.log("设置成功")},fail:function(t){console.log("设置失败"),console.log(t)}}),o.setMetaKeywords&&o.setMetaKeywords({content:"微博, 小程序",success:function(t){console.log("设置成功")},fail:function(t){console.log("设置失败"),console.log(t)}}),o.setDocumentTitle&&o.setDocumentTitle({title:"微博"}),this.setData({placeholder:t.searchValue?t.searchValue:"请输入想要搜索的内容..."}),this.data.contentSet=new Set,o.setNavigationBarTitle({title:"热搜"}),this.loadData()},onShow:function(){this.setData({isShowLoginDialog:!1});var t=this.data.statuses;if(t.length){var e=(0,f.calcData)(t);e&&this.setData({statuses:e})}T.globalData.newLogin&&(this.loadData(),T.globalData.newLogin=!1)},loadData:function(){this.data.error&&this.setData({error:!1,networkAvailable:!0,startLoading:!0,needLogin:0==T.globalData.userStatus,returnErrorCode:"",errMsg:""}),this.data.pageHotList&&0==this.data.hotListCards.length?(o.showLoading({title:"加载中"}),S.getHotSearchList(this.getHotSearchListSuccessHandler.bind(this),this.hotSearchFailHandler.bind(this))):this.data.pageSearchResult&&this.goToSearch()},onShareAppMessage:function(t){if("menu"==t.from||"menu"==t.from.from)return{title:"分享微博热搜",content:"最新鲜、最热门的热点资讯就在微博热搜",imageUrl:"https://h5.sinaimg.cn/upload/100/843/2018/11/22/weibo_icon.png",path:"/pages/hotSearch/hotSearch"};var e=t.from.target||t.target,a=e.target.dataset.card;return w.parseShareMessage(a)},getSearchResult:function(t){this.setData({navigationTitle:"搜索结果"}),this.data.page=1,this.data.userPage=1,t.currentTarget&&t.currentTarget.dataset.searchValue?(this.setData({searchValue:t.currentTarget.dataset.searchValue,placeholder:""}),this.data.hotSearchNumber=t.currentTarget.dataset.searchnumber,this.data.searchType="hotWord"):t.detail.params&&(this.data.searchValue=t.detail.params,this.data.searchType="inputWord"),this.setData({pageHotList:!1,pageSearchResult:!0,isFocus:!1,showDelete:!0,hasMoreData:!0,statuses:[],userList:[],errMsg:"",returnErrorCode:""}),this.goToSearch()},goToSearch:function(){this.data.contentSet.clear(),S.getSearchUserList(this.data.searchValue,this.data.userPage,this.getSearchUserListSuccessHandler.bind(this),this.hotSearchFailHandler.bind(this)),S.getSearchContent(this.data.searchValue,this.data.page,this.getSearchContentSuccessHandler.bind(this),this.hotSearchFailHandler.bind(this))},clearValue:function(){this.setData({navigationTitle:"热搜"}),this.setData({pageHotList:!0,pageSearchResult:!1,isFocus:!0,error:!1})},goToProfile:function(t){T.sensors.track("profilePhotoClick",{mid:"",objectUid:void 0==t.currentTarget.dataset.uid?"":t.currentTarget.dataset.uid.toString(),photoSoure:"userResult"}),o.navigateTo({url:"/pages/profile/profile?nickname="+t.currentTarget.dataset.name+"&objectUid="+t.currentTarget.dataset.uid})},goToUserList:function(){o.navigateTo({url:"/pages/searchUserResult/searchUserResult?searchValue="+this.data.searchValue})},onReachBottom:function(){this.data.pageSearchResult&&(T.sensors.track("refresh",{refreshType:"loadmore"}),this.setData({hasMoreData:!0}),this.data.page=this.data.page+1,S.getSearchContent(this.data.searchValue,this.data.page,this.getSearchContentSuccessHandler.bind(this)))},retryGetHotSearchListSuccessHandler:function(t){"-100"==t.errno||"-200"==t.errno?this.hotSearchFailHandler(t):this.getHotSearchListSuccessHandler(t)},getHotSearchListSuccessHandler:function(t){var e=this;t&&t.errno&&("-100"==t.errno||"-200"==t.errno)?D.default.updateUserStatus(function(){S.getHotSearchList(e.retryGetHotSearchListSuccessHandler.bind(e),e.hotSearchFailHandler.bind(e))}):t&&"1040002"==t.errno?(this.setData({startLoading:!1,error:!0,networkAvailable:!1,errMsg:void 0==t.errmsg?"":t.errmsg}),o.hideLoading()):o.hideLoading();var a=w.parseHotSearch(t);this.setData({startLoading:!1,title:a.title,hotListCards:a.cardsList})},hotSearchFailHandler:function(t){this.setData({startLoading:!1,error:!0,networkAvailable:!1}),o.hideLoading()},retryGetSearchContentSuccessHandler:function(t){"-100"!=t.errno||"-200"==t.errno?this.hotSearchFailHandler(t):this.getSearchContentSuccessHandler(t)},getSearchContentSuccessHandler:function(t){var e=this;if(t&&t.errno&&("-100"==t.errno||"-200"==t.errno))return void D.default.updateUserStatus(function(){S.getSearchContent(e.data.searchValue,e.data.page,e.retryGetSearchContentSuccessHandler.bind(e),e.hotSearchFailHandler.bind(e))});if(t&&"1040002"==t.errno)return void this.setData({startLoading:!1,error:!0,networkAvailable:!1});var a=w.parseHotSearchContent(t);void 0!=a.errMsg?(this.setData({hasMoreData:!1,errMsg:a.errMsg,returnErrorCode:t.cards&&t.cards.length>0&&t.cards[0].itemid?t.cards[0].itemid:"",startLoading:!1,needLogin:0==T.globalData.userStatus,error:!0}),this.trackSearch("2")):0==a.statuses.length?(this.setData({hasMoreData:!1,error:!1}),this.trackSearch("1")):(this.setData({hasMoreData:!1,statuses:this.data.statuses.concat(b.removeRepeatedBlog(a.statuses,this.data.contentSet)),startLoading:!1,needLogin:0==T.globalData.userStatus,error:!1}),this.trackSearch("0"))},trackSearch:function(t){"hotWord"==this.data.searchType?T.sensors.track("search",{keyword:this.data.searchValue,searchType:this.data.searchType,hasResult:t,hotSearchNumber:void 0==this.data.hotSearchNumber?"":this.data.hotSearchNumber.toString()}):"inputWord"==this.data.searchType&&T.sensors.track("search",{keyword:this.data.searchValue,searchType:this.data.searchType,hasResult:t})},retryGetSearchUserListHandler:function(t){"-100"==t.errno||"-200"==t.errno?this.hotSearchFailHandler(t):this.getSearchUserListSuccessHandler(t)},getSearchUserListSuccessHandler:function(t){var e=this;"-100"==t.errno||"-200"==t.errno?D.default.updateUserStatus(function(){S.getSearchUserList(e.data.searchValue,e.data.userPage,e.retryGetSearchUserListHandler.bind(e),e.hotSearchFailHandler.bind(e))}):void 0!=t.errno&&"1040002"==t.errno&&this.setData({startLoading:!1,error:!0,networkAvailable:!1});var a=w.parseHotSearchUserList(t);this.data.pageUserList=a,0==a.length?this.setData({hasMoreUser:!1}):(a.length>11&&(a=a.slice(0,11)),this.setData({hasMoreUser:!0,userList:a,userLength:a.length-1,error:!1}))}})}),window.define("pages/searchUserResult/searchUserResult",function(t,e,a,s,o,r,i,n,d,h,c,l,u,g,m,p){"use strict";var f=t("../../utils/networkUtil.js"),_=t("../../utils/parseUtil.js"),D=r();Page({data:{userList:[],userPage:1,hasMoreUser:!1,loadMoreButton:!1,showFollowButton:!0,showIsFollow:!1,isShowLoginDialog:!1,isAccoutAbnormalDialog:!1,errorType:"",errorMsg:"",showloading:!1},onLoad:function(t){o.setMetaDescription&&o.setMetaDescription({content:"一手明星动态，时下热点事件，搞笑幽默段子微博等你来看。",success:function(t){console.log("设置成功")},fail:function(t){console.log("设置失败"),console.log(t)}}),o.setMetaKeywords&&o.setMetaKeywords({content:"微博, 小程序",success:function(t){console.log("设置成功")},fail:function(t){console.log("设置失败"),console.log(t)}}),o.setDocumentTitle&&o.setDocumentTitle({title:"微博"}),this.data.searchValue=t.searchValue,f.getSearchUserList(this.data.searchValue,this.data.userPage,this.getSearchUserListSuccessHandler.bind(this))},onShow:function(){this.setData({isShowLoginDialog:!1})},onReachBottom:function(){this.setData({loadMoreButton:!1,hasMoreUser:!0}),D.sensors.track("refresh",{refreshType:"loadmore"}),this.data.userPage=this.data.userPage+1,f.getSearchUserList(this.data.searchValue,this.data.userPage,this.getSearchUserListSuccessHandler.bind(this))},loadMore:function(){this.data.userPage=this.data.userPage+1,f.getSearchUserList(this.data.searchValue,this.data.userPage,this.getSearchUserListSuccessHandler.bind(this))},getSearchUserListSuccessHandler:function(t){var e=_.parseHotSearchUserList(t);0==e.length?this.setData({hasMoreUser:!1,loadMoreButton:!1}):this.setData({userList:this.data.userList.concat(e),loadMoreButton:!(this.data.userList.length>8),hasMoreUser:e.length>8})}})}),window.define("pages/SuperSubject/SuperSubject",function(t,e,a,s,o,r,i,n,d,h,c,l,u,g,m,p){"use strict";function f(t){return t&&t.__esModule?t:{default:t}}var _=t("../../store/index"),D=t("../../utils/loginUtil"),S=f(D),w=t("../../canvas/topic"),b=f(w),T=t("../../utils/networkUtil.js"),L=t("../../utils/parseUtil.js"),I=t("../../utils/util.js"),H=(t("../../utils/event.js"),t("../../utils/userBehavior.js"),r());Page({data:{hasMoreData:!1,topicContent:"",containerid:"",superTopic:{},statuses:[],sinceId:"",error:!1,startLoading:!1,contentSet:"",isShowLoginDialog:!1,isAccoutAbnormalDialog:!1,errorType:"",errorMsg:"",refreshType:"normal",showCommentBox:!1,commentBlogId:0,contentHeight:H.globalData.realWindowHeight,showRepostChoosenToast:!1,repostChoosenToastTop:0,superSheme:"",showLaunchApp:!1,showToHome:!1,superSubjectShareCvsId:"super-subject-share",superSubjectShareCvsWidth:420,superSubjectShareCvsHeight:336,superSubjectShareImagePath:""},onLoad:function(t){o.setMetaDescription&&o.setMetaDescription({content:"一手明星动态，时下热点事件，搞笑幽默段子微博等你来看。",success:function(t){console.log("设置成功")},fail:function(t){console.log("设置失败"),console.log(t)}}),o.setMetaKeywords&&o.setMetaKeywords({content:"微博, 小程序",success:function(t){console.log("设置成功")},fail:function(t){console.log("设置失败"),console.log(t)}}),o.setDocumentTitle&&o.setDocumentTitle({title:"微博"}),this.data.contentSet=new Set,this.data.containerid=decodeURI(t.containerid),this.setData({superSheme:"sinaweibo://pageinfo?luicode=10000360&lfid=miniprogram&containerid="+t.containerid}),this.data.topicContent=t.topicContent,o.showLoading({title:"加载中"}),this.loadData(t)},onShow:function(){this.setData({isShowLoginDialog:!1,showLaunchApp:H.globalData.launchFromApp,showToHome:H.globalData.launchFromMiniProgram||H.globalData.launchFromApp});var t=this.data.statuses;if(t.length){var e=(0,_.calcData)(t);e&&this.setData({statuses:e})}},loadData:function(t){var e=this;"normal"==this.data.refreshType?(this.setData({startLoading:!0,error:!1}),S.default.checkUserStatus(function(){T.getFirstPageSuperSubject(e.data.topicContent,e.data.containerid,e.data.page,e.data.refreshType,e.getFirstPageSuperSubjectSucess.bind(e),e.getSuperSubjectFailHandler.bind(e))})):(this.setData({error:!1}),this.onReachBottom())},goToDetailDescription:function(){o.navigateTo({url:"/pages/SuperSubjectDescription/SuperSubjectDescription?userName="+encodeURIComponent(this.data.superTopic.topic_name)+"&userIcon="+encodeURIComponent(this.data.superTopic.icon)+"&description="+encodeURIComponent(this.data.superTopic.description)})},onReachBottom:function(){var t=this;this.setData({refreshType:"loadmore"}),this.data.hasMoreData&&!this.data.error&&S.default.checkUserStatus(function(){T.getMoreSuperSubject(t.data.containerid,t.data.sinceId,t.data.refreshType,t.getMoreSuperSubjectSuccess.bind(t),t.getSuperSubjectFailHandler.bind(t))})},onShareAppMessage:function(t){if("menu"==t.from||"menu"==t.from.from)return{title:"分享#"+this.data.superTopic.title+"#",content:this.data.superTopic.description,imageUrl:this.data.superTopic.icon,path:"/pages/SuperSubject/SuperSubject?containerid="+this.data.containerid};var e=t.from.target||t.target,a=e.target.dataset.card;return L.parseShareMessage(a)},getFirstPageSuperSubjectSucess:function(t){var e=this;t&&t.data&&("-100"==t.data.errno||"-200"==t.data.errno)?S.default.updateUserStatus(function(){T.getFirstPageSuperSubject(e.data.topicContent,e.data.containerid,e.data.page,e.data.refreshType,e.retryGetSuperSubjectSuccessHandler.bind(e),e.getSuperSubjectFailHandler.bind(e))}):(t&&t.data&&t.data.errno||t.data.state_code&&0!=t.data.state_code)&&(this.setData({startLoading:!1,error:!0}),o.hideLoading());var a=L.parseTopic(t.data,this.data.refreshType);this.data.sinceId=a.sinceId,a.timeline.statuses?this.setData({startLoading:!1,superTopic:a.topicDetail,hasMoreData:!(a.timeline.statuses.length<5),statuses:this.data.statuses.concat(I.removeRepeatedBlog(a.timeline.statuses,this.data.contentSet))}):this.setData({startLoading:!1,superTopic:a.topicDetail,hasMoreData:!1}),this.drawSuperSubjectShare(),o.hideLoading()},getMoreSuperSubjectSuccess:function(t){var e=this;if(t&&t.data&&("-100"==t.data.errno||"-200"==t.data.errno))S.default.updateUserStatus(function(){T.getMoreSuperSubject(e.data.containerid,e.data.sinceId,e.data.refreshType,e.retryGetMoreSuperSubjectHandler.bind(e),e.getSuperSubjectFailHandler.bind(e))});else if(t&&t.data&&t.data.errno||t.data.state_code&&0!=t.data.state_code)this.setData({error:!0});else{var a=L.parseTopic(t.data,this.data.refreshType);this.data.sinceId=a.sinceId,this.setData({hasMoreData:!(0==a.timeline.statuses.length),statuses:this.data.statuses.concat(I.removeRepeatedBlog(a.timeline.statuses,this.data.contentSet))})}},retryGetSuperSubjectSuccessHandler:function(t){"-100"==t.errno||"-200"==t.errno?(this.setData({startLoading:!1,error:!0}),o.hideLoading()):this.getFirstPageSuperSubjectSucess(t)},retryGetMoreSuperSubjectHandler:function(t){"-100"==t.errno||"-200"==t.errno?this.setData({error:!0}):this.getMoreSuperSubjectSuccess(t)},getSuperSubjectFailHandler:function(t){this.setData({startLoading:!1,error:!0}),o.hideLoading()},scrolling:function(t){t.detail.scrollTop>100?this.setData({topicContent:decodeURIComponent(this.data.superTopic.title)}):this.setData({topicContent:""})},drawSuperSubjectShare:function(){var t=this,e=this.data.superTopic;(0,b.default)(this,this.data.superSubjectShareCvsId,this.data.superSubjectShareCvsWidth,this.data.superSubjectShareCvsHeight,{topic:e.title,pic:e.icon,descArr:[e.readNum,e.discussNum,e.fansNum],isSuper:!0}).then(function(e){t.setData({superSubjectShareImagePath:e})}).catch(function(t){})}})}),window.define("pages/SuperSubjectDescription/SuperSubjectDescription",function(t,e,a,s,o,r,i,n,d,h,c,l,u,g,m,p){"use strict";Page({data:{userName:"",userIconSrc:"",description:"",srollHeight:300},onLoad:function(t){o.setMetaDescription&&o.setMetaDescription({content:"一手明星动态，时下热点事件，搞笑幽默段子微博等你来看。",success:function(t){console.log("设置成功")},fail:function(t){console.log("设置失败"),console.log(t)}}),o.setMetaKeywords&&o.setMetaKeywords({content:"微博, 小程序",success:function(t){console.log("设置成功")},fail:function(t){console.log("设置失败"),console.log(t)}}),o.setDocumentTitle&&o.setDocumentTitle({title:"微博"}),this.setData({userName:decodeURIComponent(t.userName),userIconSrc:decodeURIComponent(t.userIcon),description:decodeURIComponent(t.description)})},onShow:function(){var t=this;o.getSystemInfo({success:function(e){var a=e.windowHeight;t.setData({srollHeight:a})}})},onHide:function(){},scrolling:function(t){t.detail.scrollTop>80?o.setNavigationBarTitle({title:this.data.userName}):o.setNavigationBarTitle({title:""})}})}),window.define("pages/topic/topic",function(t,e,a,s,o,r,i,n,d,h,c,l,u,g,m,p){"use strict";function f(t){return t&&t.__esModule?t:{default:t}}var _=t("../../store/index"),D=t("../../utils/loginUtil"),S=f(D),w=t("../../canvas/topic"),b=f(w),T=t("../../utils/networkUtil.js"),L=t("../../utils/parseUtil.js"),I=t("../../utils/util.js"),H=(t("../../utils/event.js"),t("../../utils/userBehavior.js"),r()),v="";Page({data:{hasMoreData:!0,containerid:"",page:1,superTopic:{},statuses:[],error:!1,contentSet:"",startLoading:!1,isShowLoginDialog:!1,isAccoutAbnormalDialog:!1,errorType:"",errorMsg:"",refreshType:"auto",showCommentBox:!1,commentBlogId:0,contentHeight:H.globalData.realWindowHeight,showRepostChoosenToast:!1,repostChoosenToastTop:0,topicContent:"",topicSheme:"",showLaunchApp:!1,showToHome:!1,topicShareCvsId:"topic-share",topicShareCvsWidth:420,topicShareCvsHeight:336,topicShareImagePath:"",needLogin:!1},onLoad:function(t){o.setMetaDescription&&o.setMetaDescription({content:"一手明星动态，时下热点事件，搞笑幽默段子微博等你来看。",success:function(t){console.log("设置成功")},fail:function(t){console.log("设置失败"),console.log(t)}}),o.setMetaKeywords&&o.setMetaKeywords({content:"微博, 小程序",success:function(t){console.log("设置成功")},fail:function(t){console.log("设置失败"),console.log(t)}}),o.setDocumentTitle&&o.setDocumentTitle({title:"微博"});var e=I.getUrlParam(decodeURIComponent(t.containerid),"q");this.setData({topicSheme:"sinaweibo://searchall?containerid=231522&luicode=10000360&lfid=miniprogram&q="+encodeURIComponent(e)}),t&&t.topicContent&&(v=t.topicContent),this.data.contentSet=new Set,this.data.containerid=decodeURI(t.containerid),o.showLoading({title:"加载中"}),this.loadData()},onShow:function(){this.setData({isShowLoginDialog:!1,showLaunchApp:H.globalData.launchFromApp,showToHome:H.globalData.launchFromMiniProgram||H.globalData.launchFromApp});var t=this.data.statuses;if(t.length){var e=(0,_.calcData)(t);e&&this.setData({statuses:e})}},onHide:function(){},loadData:function(){var t=this;"auto"==this.data.refreshType?(this.setData({startLoading:!0,error:!1}),S.default.checkUserStatus(function(){T.getTopic(t.data.containerid,t.data.page,"topicPageLoad",t.getTopicSucess.bind(t),t.getTopicFailHandler.bind(t))})):(this.setData({error:!1}),this.data.hasMoreData&&this.onReachBottom())},onReachBottom:function(){var t=this;this.data.hasMoreData&&!this.data.error&&(this.setData({refreshType:"loadmore"}),this.data.page=this.data.page+1,S.default.checkUserStatus(function(){T.getTopic(t.data.containerid,t.data.page,void 0,t.getTopicSucess.bind(t),t.getTopicFailHandler.bind(t))}))},onShareAppMessage:function(t){if("menu"==t.from||"menu"==t.from.from)return{title:"分享"+this.data.superTopic.title,content:this.data.superTopic.discussNum,imageUrl:this.data.superTopic.icon,path:"/pages/topic/topic?containerid="+encodeURIComponent(encodeURIComponent(this.data.containerid))};var e=t.from.target||t.target,a=e.target.dataset.card;return L.parseShareMessage(a)},getTopicSucess:function(t){var e=this;if(t&&t.data&&("-100"==t.data.errno||"-200"==t.data.errno))S.default.updateUserStatus(function(){"auto"==e.data.refreshType?(e.setData({startLoading:!0,error:!1}),T.getTopic(e.data.containerid,e.data.page,"topicPageLoad",e.retryGetTopicSuccessHandler.bind(e),e.getTopicFailHandler.bind(e))):(e.setData({error:!1}),e.data.hasMoreData&&T.getTopic(e.data.containerid,e.data.page,void 0,e.retryGetTopicSuccessHandler.bind(e),e.getTopicFailHandler.bind(e)))});else if(t&&t.data&&void 0!=t.data.errno||void 0!=t.data.state_code&&0!=t.data.state_code)this.setData({startLoading:!1,error:!0}),o.hideLoading();else{var a=L.parseTopic(t.data,"topicPageLoad");"needLogin"==a.errMsg?this.setData({startLoading:!1,superTopic:a.topicDetail,hasMoreData:!1,needLogin:!0,error:!0,errorMsg:"暂无查看权限"}):void 0==a.timeline.statuses?this.setData({startLoading:!1,superTopic:a.topicDetail,hasMoreData:!1}):this.setData({startLoading:!1,superTopic:a.topicDetail,hasMoreData:!(a.timeline.statuses.length<5),statuses:this.data.statuses.concat(I.removeRepeatedBlog(a.timeline.statuses,this.data.contentSet))}),this.drawTopicShare(),o.hideLoading()}},retryGetTopicSuccessHandler:function(t){t&&t.data&&void 0!=t.data.errno&&("-100"==t.data.errno||"-200"==t.data.errno)?this.getTopicFailHandler():this.getTopicSucess(t)},getTopicFailHandler:function(t){this.setData({startLoading:!1,error:!0}),o.hideLoading()},scrolling:function(t){t.detail.scrollTop>100?this.setData({topicContent:decodeURIComponent(v)}):this.setData({topicContent:""})},drawTopicShare:function(){var t=this,e=this.data.superTopic;(0,b.default)(this,this.data.topicShareCvsId,this.data.topicShareCvsWidth,this.data.topicShareCvsHeight,{topic:e.title,pic:e.icon,descArr:[e.readNum,e.discussNum]}).then(function(e){t.setData({topicShareImagePath:e})}).catch(function(t){})}})}),window.define("pages/WebView/WebView",function(t,e,a,s,o,r,i,n,d,h,c,l,u,g,m,p){"use strict";Page({data:{href:""},onLoad:function(t){o.setMetaDescription&&o.setMetaDescription({content:"一手明星动态，时下热点事件，搞笑幽默段子微博等你来看。",success:function(t){console.log("设置成功")},fail:function(t){console.log("设置失败"),console.log(t)}}),o.setMetaKeywords&&o.setMetaKeywords({content:"微博, 小程序",success:function(t){console.log("设置成功")},fail:function(t){console.log("设置失败"),console.log(t)}}),o.setDocumentTitle&&o.setDocumentTitle({title:"微博"}),console.log("========== WebView =========="),console.log(t.href);var e=t.href;e=e.replace(/\@\@\@\@\@/g,"?"),e=e.replace(/\#\#\#\#\#/g,"="),console.log(e),this.setData({href:e})}})}),window.define("pages/BDLongText/BDLongText",function(t,e,a,s,o,r,i,n,d,h,c,l,u,g,m,p){"use strict";function f(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var _,D=t("../../utils/loginUtil"),S=function(t){return t&&t.__esModule?t:{default:t}}(D),w=t("../../utils/networkUtil.js"),b=t("../../utils/parseUtil.js"),T=r();Page({data:(_={error:!1,networkAvailable:!0,BDContent:"",basedStatus:null},f(_,"BDContent",""),f(_,"month",""),f(_,"day",""),f(_,"header",""),f(_,"userName",""),f(_,"errorMsg",""),f(_,"startLoading",!1),f(_,"showToHome",!0),_),jsData:{oid:"",luicode:"",lfid:""},onLoad:function(t){o.setMetaDescription&&o.setMetaDescription({content:"一手明星动态，时下热点事件，搞笑幽默段子微博等你来看。",success:function(t){console.log("设置成功")},fail:function(t){console.log("设置失败"),console.log(t)}}),o.setMetaKeywords&&o.setMetaKeywords({content:"微博, 小程序",success:function(t){console.log("设置成功")},fail:function(t){console.log("设置失败"),console.log(t)}}),o.setDocumentTitle&&o.setDocumentTitle({title:"微博"}),t.oid?this.jsData.oid=t.oid:this.jsData.oid="t5gFyVXk+bPkVTmQpmqMrJLYho4Q7QWTMa+8g+h0AsQ=",this.jsData.luicode=t.luicode||"",this.jsData.lfid=t.lfid||"",""!==this.jsData.lfid&&T.sensors.register({source:this.jsData.lfid}),this.loadData()},onShow:function(){this.setData({showToHome:T.globalData.showToHome})},loadData:function(){var t=this;this.setData({error:!1,errorMsg:"",startLoading:!0}),o.showLoading({title:"加载中"}),S.default.checkUserStatus(function(){""!==t.jsData.luicode&&""!==t.jsData.lfid&&w.addLogBatch(t.jsData.luicode,t.jsData.lfid),w.getBDLongText(t.jsData.oid,t.getLongTextSuccessHandler.bind(t),t.getLongTextFailHandler.bind(t),t.getLongTextCompleteHandler.bind(t))})},getLongTextSuccessHandler:function(t){var e=this;if("-100"==t.errno||"-200"==t.errno)return void S.default.updateUserStatus(function(){w.getBDLongText(e.jsData.oid,e.retryGetLongTextSuccessHandler.bind(e),e.getLongTextFailHandler.bind(e),e.getLongTextCompleteHandler.bind(e))});if(t&&(t.errno||1==t.invalid))return void this.setData({error:!0,startLoading:!1});var a=b.parseLongText(t);if(a.content){var s=t.content.replace(/font/gi,"p");s=s.replace(/<img/gi,"<img width = '100%'"),console.log(s),this.setData({header:t.userinfo.avatar_hd,BDContent:s,userName:t.userinfo.name,title:t.title,month:new Date(t.create_at).getMonth()+1,day:new Date(t.create_at).getDate(),startLoading:!1,error:!1}),this.data.basedStatus=a.status}else this.setData({error:!0,startLoading:!1})},retryGetLongTextSuccessHandler:function(t){if("-100"==t.errno||"-200"==t.errno)return void this.setData({error:!0,errorMsg:"暂无权限查看",startLoading:!1});this.getLongTextSuccessHandler(t)},getLongTextFailHandler:function(t){this.setData({error:!0,networkAvailable:!1,startLoading:!1})},getLongTextCompleteHandler:function(t){o.hideLoading()}})}),window.__swanRoute="pages/feed/feed",window.usingComponents=["common/FeedList/FeedList","common/TabBar/TabBar","common/NetworkErrorToast/NetworkErrorToast","common/NetworkErrorItem/NetworkErrorItem"],require("pages/feed/feed"),window.__swanRoute="pages/index/index",window.usingComponents=["common/Header/Header","common/Error/Error","common/NetworkErrorToast/NetworkErrorToast","common/Content/Content","common/MBlogMedia/MBlogMedia","common/RetweetCard/RetweetCard","common/Comment/Comment","common/WaterPullFlow/WaterPullFlow","common/FooterA/FooterA","common/ToHomeButton/ToHomeButton"],require("pages/index/index"),window.__swanRoute="pages/CommentDetail/CommentDetail",window.usingComponents=["common/Comment/Comment","common/Error/Error"],require("pages/CommentDetail/CommentDetail"),window.__swanRoute="pages/profile/profile",window.usingComponents=["common/FeedList/FeedList","common/NetworkErrorToast/NetworkErrorToast","common/NetworkErrorItem/NetworkErrorItem","common/ToHomeButton/ToHomeButton"],require("pages/profile/profile"),window.__swanRoute="pages/hotSearch/hotSearch",window.usingComponents=["common/FeedList/FeedList","common/Search/Search","common/Error/Error","common/NetworkErrorToast/NetworkErrorToast"],require("pages/hotSearch/hotSearch"),window.__swanRoute="pages/searchUserResult/searchUserResult",window.usingComponents=["common/UserList/UserList"],require("pages/searchUserResult/searchUserResult"),window.__swanRoute="pages/SuperSubject/SuperSubject",window.usingComponents=["common/FeedList/FeedList","common/NetworkErrorToast/NetworkErrorToast","common/NetworkErrorItem/NetworkErrorItem","common/ToHomeButton/ToHomeButton"],require("pages/SuperSubject/SuperSubject"),window.__swanRoute="pages/SuperSubjectDescription/SuperSubjectDescription",window.usingComponents=["common/FeedList/FeedList"],require("pages/SuperSubjectDescription/SuperSubjectDescription"),window.__swanRoute="pages/topic/topic",window.usingComponents=["common/FeedList/FeedList","common/NetworkErrorToast/NetworkErrorToast","common/NetworkErrorItem/NetworkErrorItem","common/ToHomeButton/ToHomeButton"],require("pages/topic/topic"),window.__swanRoute="pages/WebView/WebView",window.usingComponents=[],require("pages/WebView/WebView"),window.__swanRoute="pages/BDLongText/BDLongText",window.usingComponents=["common/NetworkErrorToast/NetworkErrorToast","common/ToHomeButton/ToHomeButton"],require("pages/BDLongText/BDLongText");