window.define("pages/pingjia/storeevaluate/index",function(a,e,t,i,n,s,u,o,r,d,l,g,p,v,m,c){"use strict";var h=a("../../../network/api"),y=function(a){return a&&a.__esModule?a:{default:a}}(h);Page({data:{toggle:!0,loadmore:!1,loadingmore:!1,query:{pageNo:1,pageSize:2,status:-1},pingjiaArray:[{name:"全部",num:0,type:"reviewsNum"},{name:"好评",num:0,type:"goodReviewsNum"},{name:"中评",num:0,type:"middleReviewsNum"},{name:"差评",num:0,type:"badReviewsNum"},{name:"有图",num:0,type:"imgReviewsNum"}]},onLoad:function(a){a.id&&(this.setData({id:a.id,"query.status":a.status||-1}),n.showLoading({title:"加载中"})),a&&a.openevaluate&&this.setData({openevaluate:a.openevaluate}),1==this.data.openevaluate&&this.queryStoreEvaluate(this.data.query,!0)},queryStoreEvaluate:function(a,e){var t=this;n.showLoading({title:"请稍后"}),y.default.queryStoreEvaluate(Object.assign({},a,{storeId:this.data.id})).then(function(a){n.hideLoading(),t.setData({storeEvaluateData:e?a.data:Object.assign({},t.data.storeEvaluateData,{data:t.data.storeEvaluateData.data.concat(a.data.data)}),loadmore:a.data.nextCursor>0,loadingmore:!1,query:Object.assign({},t.data.query,{pageNo:a.data.nextCursor,pageSize:a.data.pageSize}),isShow:!0,scrollTop:e?0:null,pingjiaArray:t.data.pingjiaArray.map(function(e){return Object.assign({},e,{num:a.data[""+e.type]})})})}).catch(function(a){return console.log(a)})},lower:function(){this.data.loadmore&&!this.data.loadingmore&&(this.setData({loadingmore:!0}),this.queryStoreEvaluate(Object.assign({},this.data.query),!1))},evaluateTab:function(a){var e=a.detail.evaluate;this.setData({"query.status":e}),this.queryStoreEvaluate(this.data.query,!0)},onTapPic:function(a){var e=a.currentTarget.dataset,t=e.imgindex,i=e.type,s=e.index;n.previewImage({current:a.currentTarget.dataset.link,urls:"first"==i?this.data.storeEvaluateData.data[s].evaluates[t].firstEvaluateImgs:this.data.storeEvaluateData.data[s].evaluates[t].secondEvaluateImgs})}}),Page({})}),window.__swanRoute="pages/pingjia/storeevaluate/index",window.usingComponents=["pages/pingjia/component/evaluatecontent/index","pages/pingjia/component/evaluateitems/index","dist/minui/wxc-abnor/dist/index","pages/pingjia/storeevaluate/index"],require("pages/pingjia/storeevaluate/index");