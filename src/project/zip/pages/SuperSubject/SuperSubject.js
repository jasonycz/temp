window.define("pages/SuperSubject/SuperSubject",function(t,e,a,s,o,r,i,n,c,u,d,p,h,S,l,g){"use strict";function m(t){return t&&t.__esModule?t:{default:t}}var b=t("../../store/index"),f=t("../../utils/loginUtil"),j=m(f),D=t("../../canvas/topic"),T=m(D),w=t("../../utils/networkUtil.js"),v=t("../../utils/parseUtil.js"),C=t("../../utils/util.js"),M=(t("../../utils/event.js"),t("../../utils/userBehavior.js"),r());Page({data:{hasMoreData:!1,topicContent:"",containerid:"",superTopic:{},statuses:[],sinceId:"",error:!1,startLoading:!1,contentSet:"",isShowLoginDialog:!1,isAccoutAbnormalDialog:!1,errorType:"",errorMsg:"",refreshType:"normal",showCommentBox:!1,commentBlogId:0,contentHeight:M.globalData.realWindowHeight,showRepostChoosenToast:!1,repostChoosenToastTop:0,superSheme:"",showLaunchApp:!1,showToHome:!1,superSubjectShareCvsId:"super-subject-share",superSubjectShareCvsWidth:420,superSubjectShareCvsHeight:336,superSubjectShareImagePath:""},onLoad:function(t){o.setMetaDescription&&o.setMetaDescription({content:"一手明星动态，时下热点事件，搞笑幽默段子微博等你来看。",success:function(t){console.log("设置成功")},fail:function(t){console.log("设置失败"),console.log(t)}}),o.setMetaKeywords&&o.setMetaKeywords({content:"微博, 小程序",success:function(t){console.log("设置成功")},fail:function(t){console.log("设置失败"),console.log(t)}}),o.setDocumentTitle&&o.setDocumentTitle({title:"微博"}),this.data.contentSet=new Set,this.data.containerid=decodeURI(t.containerid),this.setData({superSheme:"sinaweibo://pageinfo?luicode=10000360&lfid=miniprogram&containerid="+t.containerid}),this.data.topicContent=t.topicContent,o.showLoading({title:"加载中"}),this.loadData(t)},onShow:function(){this.setData({isShowLoginDialog:!1,showLaunchApp:M.globalData.launchFromApp,showToHome:M.globalData.launchFromMiniProgram||M.globalData.launchFromApp});var t=this.data.statuses;if(t.length){var e=(0,b.calcData)(t);e&&this.setData({statuses:e})}},loadData:function(t){var e=this;"normal"==this.data.refreshType?(this.setData({startLoading:!0,error:!1}),j.default.checkUserStatus(function(){w.getFirstPageSuperSubject(e.data.topicContent,e.data.containerid,e.data.page,e.data.refreshType,e.getFirstPageSuperSubjectSucess.bind(e),e.getSuperSubjectFailHandler.bind(e))})):(this.setData({error:!1}),this.onReachBottom())},goToDetailDescription:function(){o.navigateTo({url:"/pages/SuperSubjectDescription/SuperSubjectDescription?userName="+encodeURIComponent(this.data.superTopic.topic_name)+"&userIcon="+encodeURIComponent(this.data.superTopic.icon)+"&description="+encodeURIComponent(this.data.superTopic.description)})},onReachBottom:function(){var t=this;this.setData({refreshType:"loadmore"}),this.data.hasMoreData&&!this.data.error&&j.default.checkUserStatus(function(){w.getMoreSuperSubject(t.data.containerid,t.data.sinceId,t.data.refreshType,t.getMoreSuperSubjectSuccess.bind(t),t.getSuperSubjectFailHandler.bind(t))})},onShareAppMessage:function(t){if("menu"==t.from||"menu"==t.from.from)return{title:"分享#"+this.data.superTopic.title+"#",content:this.data.superTopic.description,imageUrl:this.data.superTopic.icon,path:"/pages/SuperSubject/SuperSubject?containerid="+this.data.containerid};var e=t.from.target||t.target,a=e.target.dataset.card;return v.parseShareMessage(a)},getFirstPageSuperSubjectSucess:function(t){var e=this;t&&t.data&&("-100"==t.data.errno||"-200"==t.data.errno)?j.default.updateUserStatus(function(){w.getFirstPageSuperSubject(e.data.topicContent,e.data.containerid,e.data.page,e.data.refreshType,e.retryGetSuperSubjectSuccessHandler.bind(e),e.getSuperSubjectFailHandler.bind(e))}):(t&&t.data&&t.data.errno||t.data.state_code&&0!=t.data.state_code)&&(this.setData({startLoading:!1,error:!0}),o.hideLoading());var a=v.parseTopic(t.data,this.data.refreshType);this.data.sinceId=a.sinceId,a.timeline.statuses?this.setData({startLoading:!1,superTopic:a.topicDetail,hasMoreData:!(a.timeline.statuses.length<5),statuses:this.data.statuses.concat(C.removeRepeatedBlog(a.timeline.statuses,this.data.contentSet))}):this.setData({startLoading:!1,superTopic:a.topicDetail,hasMoreData:!1}),this.drawSuperSubjectShare(),o.hideLoading()},getMoreSuperSubjectSuccess:function(t){var e=this;if(t&&t.data&&("-100"==t.data.errno||"-200"==t.data.errno))j.default.updateUserStatus(function(){w.getMoreSuperSubject(e.data.containerid,e.data.sinceId,e.data.refreshType,e.retryGetMoreSuperSubjectHandler.bind(e),e.getSuperSubjectFailHandler.bind(e))});else if(t&&t.data&&t.data.errno||t.data.state_code&&0!=t.data.state_code)this.setData({error:!0});else{var a=v.parseTopic(t.data,this.data.refreshType);this.data.sinceId=a.sinceId,this.setData({hasMoreData:!(0==a.timeline.statuses.length),statuses:this.data.statuses.concat(C.removeRepeatedBlog(a.timeline.statuses,this.data.contentSet))})}},retryGetSuperSubjectSuccessHandler:function(t){"-100"==t.errno||"-200"==t.errno?(this.setData({startLoading:!1,error:!0}),o.hideLoading()):this.getFirstPageSuperSubjectSucess(t)},retryGetMoreSuperSubjectHandler:function(t){"-100"==t.errno||"-200"==t.errno?this.setData({error:!0}):this.getMoreSuperSubjectSuccess(t)},getSuperSubjectFailHandler:function(t){this.setData({startLoading:!1,error:!0}),o.hideLoading()},scrolling:function(t){t.detail.scrollTop>100?this.setData({topicContent:decodeURIComponent(this.data.superTopic.title)}):this.setData({topicContent:""})},drawSuperSubjectShare:function(){var t=this,e=this.data.superTopic;(0,T.default)(this,this.data.superSubjectShareCvsId,this.data.superSubjectShareCvsWidth,this.data.superSubjectShareCvsHeight,{topic:e.title,pic:e.icon,descArr:[e.readNum,e.discussNum,e.fansNum],isSuper:!0}).then(function(e){t.setData({superSubjectShareImagePath:e})}).catch(function(t){})}})}),window.__swanRoute="pages/SuperSubject/SuperSubject",window.usingComponents=["common/FeedList/FeedList","common/NetworkErrorToast/NetworkErrorToast","common/NetworkErrorItem/NetworkErrorItem","common/ToHomeButton/ToHomeButton"],require("pages/SuperSubject/SuperSubject");