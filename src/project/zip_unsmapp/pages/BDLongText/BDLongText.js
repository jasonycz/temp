window.define("pages/BDLongText/BDLongText",function(t,e,o,n,a,s,i,r,l,d,g,c,u,D,f,h){"use strict";function L(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}var T,m=t("../../utils/loginUtil"),w=function(t){return t&&t.__esModule?t:{default:t}}(m),x=t("../../utils/networkUtil.js"),p=t("../../utils/parseUtil.js"),b=s();Page({data:(T={error:!1,networkAvailable:!0,BDContent:"",basedStatus:null},L(T,"BDContent",""),L(T,"month",""),L(T,"day",""),L(T,"header",""),L(T,"userName",""),L(T,"errorMsg",""),L(T,"startLoading",!1),L(T,"showToHome",!0),T),jsData:{oid:"",luicode:"",lfid:""},onLoad:function(t){a.setMetaDescription&&a.setMetaDescription({content:"一手明星动态，时下热点事件，搞笑幽默段子微博等你来看。",success:function(t){console.log("设置成功")},fail:function(t){console.log("设置失败"),console.log(t)}}),a.setMetaKeywords&&a.setMetaKeywords({content:"微博, 小程序",success:function(t){console.log("设置成功")},fail:function(t){console.log("设置失败"),console.log(t)}}),a.setDocumentTitle&&a.setDocumentTitle({title:"微博"}),t.oid?this.jsData.oid=t.oid:this.jsData.oid="t5gFyVXk+bPkVTmQpmqMrJLYho4Q7QWTMa+8g+h0AsQ=",this.jsData.luicode=t.luicode||"",this.jsData.lfid=t.lfid||"",""!==this.jsData.lfid&&b.sensors.register({source:this.jsData.lfid}),this.loadData()},onShow:function(){this.setData({showToHome:b.globalData.showToHome})},loadData:function(){var t=this;this.setData({error:!1,errorMsg:"",startLoading:!0}),a.showLoading({title:"加载中"}),w.default.checkUserStatus(function(){""!==t.jsData.luicode&&""!==t.jsData.lfid&&x.addLogBatch(t.jsData.luicode,t.jsData.lfid),x.getBDLongText(t.jsData.oid,t.getLongTextSuccessHandler.bind(t),t.getLongTextFailHandler.bind(t),t.getLongTextCompleteHandler.bind(t))})},getLongTextSuccessHandler:function(t){var e=this;if("-100"==t.errno||"-200"==t.errno)return void w.default.updateUserStatus(function(){x.getBDLongText(e.jsData.oid,e.retryGetLongTextSuccessHandler.bind(e),e.getLongTextFailHandler.bind(e),e.getLongTextCompleteHandler.bind(e))});if(t&&(t.errno||1==t.invalid))return void this.setData({error:!0,startLoading:!1});var o=p.parseLongText(t);if(o.content){var n=t.content.replace(/font/gi,"p");n=n.replace(/<img/gi,"<img width = '100%'"),console.log(n),this.setData({header:t.userinfo.avatar_hd,BDContent:n,userName:t.userinfo.name,title:t.title,month:new Date(t.create_at).getMonth()+1,day:new Date(t.create_at).getDate(),startLoading:!1,error:!1}),this.data.basedStatus=o.status}else this.setData({error:!0,startLoading:!1})},retryGetLongTextSuccessHandler:function(t){if("-100"==t.errno||"-200"==t.errno)return void this.setData({error:!0,errorMsg:"暂无权限查看",startLoading:!1});this.getLongTextSuccessHandler(t)},getLongTextFailHandler:function(t){this.setData({error:!0,networkAvailable:!1,startLoading:!1})},getLongTextCompleteHandler:function(t){a.hideLoading()}})}),window.__swanRoute="pages/BDLongText/BDLongText",window.usingComponents=["common/NetworkErrorToast/NetworkErrorToast","common/ToHomeButton/ToHomeButton"],require("pages/BDLongText/BDLongText");