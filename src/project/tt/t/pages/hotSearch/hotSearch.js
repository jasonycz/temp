window.define("pages/hotSearch/hotSearch",function(e,t,a,s,r,o,h,c,i,n,u,g,l,d,_,m){"use strict";var p=e("../../store/index"),S=e("../../utils/loginUtil"),b=function(e){return e&&e.__esModule?e:{default:e}}(S),L=e("../../utils/networkUtil.js"),f=e("../../utils/parseUtil.js"),D=e("../../utils/util.js"),H=(e("../../utils/event.js"),e("../../utils/userBehavior.js"),o());Page({data:{top:H.globalData.totalTopHeight,navigationTitle:"热搜",pageHotList:!0,pageSearchResult:!1,isFocus:!0,startLoading:!0,error:!1,title:"",hotListCards:[],searchValue:"",hotSearchNumber:"",searchType:"",showDelete:!1,placeholder:"请输入想要搜索的内容...",imageList:["../../static/resources/images/hot_search/hotsearch_top.png","../../static/resources/images/hot_search/hotsearch_number_1.png","../../static/resources/images/hot_search/hotsearch_number_2.png","../../static/resources/images/hot_search/hotsearch_number_3.png","../../static/resources/images/hot_search/hotsearch_number_4.png","../../static/resources/images/hot_search/hotsearch_number_5.png","../../static/resources/images/hot_search/hotsearch_number_6.png","../../static/resources/images/hot_search/hotsearch_number_7.png","../../static/resources/images/hot_search/hotsearch_number_8.png","../../static/resources/images/hot_search/hotsearch_number_9.png","../../static/resources/images/hot_search/hotsearch_number_10.png","../../static/resources/images/hot_search/hotsearch_number_11.png","../../static/resources/images/hot_search/hotsearch_number_12.png","../../static/resources/images/hot_search/hotsearch_number_13.png","../../static/resources/images/hot_search/hotsearch_number_14.png","../../static/resources/images/hot_search/hotsearch_number_15.png","../../static/resources/images/hot_search/hotsearch_number_16.png","../../static/resources/images/hot_search/hotsearch_number_17.png","../../static/resources/images/hot_search/hotsearch_number_18.png","../../static/resources/images/hot_search/hotsearch_number_19.png","../../static/resources/images/hot_search/hotsearch_number_20.png","../../static/resources/images/hot_search/hotsearch_number_21.png","../../static/resources/images/hot_search/hotsearch_number_22.png","../../static/resources/images/hot_search/hotsearch_number_23.png","../../static/resources/images/hot_search/hotsearch_number_24.png","../../static/resources/images/hot_search/hotsearch_number_25.png","../../static/resources/images/hot_search/hotsearch_number_26.png","../../static/resources/images/hot_search/hotsearch_number_27.png","../../static/resources/images/hot_search/hotsearch_number_28.png","../../static/resources/images/hot_search/hotsearch_number_29.png","../../static/resources/images/hot_search/hotsearch_number_30.png","../../static/resources/images/hot_search/hotsearch_number_31.png","../../static/resources/images/hot_search/hotsearch_number_32.png","../../static/resources/images/hot_search/hotsearch_number_33.png","../../static/resources/images/hot_search/hotsearch_number_34.png","../../static/resources/images/hot_search/hotsearch_number_35.png","../../static/resources/images/hot_search/hotsearch_number_36.png","../../static/resources/images/hot_search/hotsearch_number_37.png","../../static/resources/images/hot_search/hotsearch_number_38.png","../../static/resources/images/hot_search/hotsearch_number_39.png","../../static/resources/images/hot_search/hotsearch_number_40.png","../../static/resources/images/hot_search/hotsearch_number_41.png","../../static/resources/images/hot_search/hotsearch_number_42.png","../../static/resources/images/hot_search/hotsearch_number_43.png","../../static/resources/images/hot_search/hotsearch_number_44.png","../../static/resources/images/hot_search/hotsearch_number_45.png","../../static/resources/images/hot_search/hotsearch_number_46.png","../../static/resources/images/hot_search/hotsearch_number_47.png","../../static/resources/images/hot_search/hotsearch_number_48.png","../../static/resources/images/hot_search/hotsearch_number_49.png","../../static/resources/images/hot_search/hotsearch_number_50.png"],statuses:[],userList:[],pageUserList:[],userLength:0,page:1,userPage:1,hasMoreData:!0,hasMoreUser:!1,errMsg:"",needLogin:0==H.globalData.userStatus,returnErrorCode:"",contentSet:"",isShowLoginDialog:!1,isAccoutAbnormalDialog:!1,errorType:"",errorMsg:"",networkAvailable:!0,showCommentBox:!1,commentBlogId:0,contentHeight:H.globalData.realWindowHeight,showRepostChoosenToast:!1,repostChoosenToastTop:0},onLoad:function(e){r.setMetaDescription&&r.setMetaDescription({content:"一手明星动态，时下热点事件，搞笑幽默段子微博等你来看。",success:function(e){console.log("设置成功")},fail:function(e){console.log("设置失败"),console.log(e)}}),r.setMetaKeywords&&r.setMetaKeywords({content:"微博, 小程序",success:function(e){console.log("设置成功")},fail:function(e){console.log("设置失败"),console.log(e)}}),r.setDocumentTitle&&r.setDocumentTitle({title:"微博"}),this.setData({placeholder:e.searchValue?e.searchValue:"请输入想要搜索的内容..."}),this.data.contentSet=new Set,r.setNavigationBarTitle({title:"热搜"}),this.loadData()},onShow:function(){this.setData({isShowLoginDialog:!1});var e=this.data.statuses;if(e.length){var t=(0,p.calcData)(e);t&&this.setData({statuses:t})}H.globalData.newLogin&&(this.loadData(),H.globalData.newLogin=!1)},loadData:function(){this.data.error&&this.setData({error:!1,networkAvailable:!0,startLoading:!0,needLogin:0==H.globalData.userStatus,returnErrorCode:"",errMsg:""}),this.data.pageHotList&&0==this.data.hotListCards.length?(r.showLoading({title:"加载中"}),L.getHotSearchList(this.getHotSearchListSuccessHandler.bind(this),this.hotSearchFailHandler.bind(this))):this.data.pageSearchResult&&this.goToSearch()},onShareAppMessage:function(e){if("menu"==e.from||"menu"==e.from.from)return{title:"分享微博热搜",content:"最新鲜、最热门的热点资讯就在微博热搜",imageUrl:"https://h5.sinaimg.cn/upload/100/843/2018/11/22/weibo_icon.png",path:"/pages/hotSearch/hotSearch"};var t=e.from.target||e.target,a=t.target.dataset.card;return f.parseShareMessage(a)},getSearchResult:function(e){this.setData({navigationTitle:"搜索结果"}),this.data.page=1,this.data.userPage=1,e.currentTarget&&e.currentTarget.dataset.searchValue?(this.setData({searchValue:e.currentTarget.dataset.searchValue,placeholder:""}),this.data.hotSearchNumber=e.currentTarget.dataset.searchnumber,this.data.searchType="hotWord"):e.detail.params&&(this.data.searchValue=e.detail.params,this.data.searchType="inputWord"),this.setData({pageHotList:!1,pageSearchResult:!0,isFocus:!1,showDelete:!0,hasMoreData:!0,statuses:[],userList:[],errMsg:"",returnErrorCode:""}),this.goToSearch()},goToSearch:function(){this.data.contentSet.clear(),L.getSearchUserList(this.data.searchValue,this.data.userPage,this.getSearchUserListSuccessHandler.bind(this),this.hotSearchFailHandler.bind(this)),L.getSearchContent(this.data.searchValue,this.data.page,this.getSearchContentSuccessHandler.bind(this),this.hotSearchFailHandler.bind(this))},clearValue:function(){this.setData({navigationTitle:"热搜"}),this.setData({pageHotList:!0,pageSearchResult:!1,isFocus:!0,error:!1})},goToProfile:function(e){H.sensors.track("profilePhotoClick",{mid:"",objectUid:void 0==e.currentTarget.dataset.uid?"":e.currentTarget.dataset.uid.toString(),photoSoure:"userResult"}),r.navigateTo({url:"/pages/profile/profile?nickname="+e.currentTarget.dataset.name+"&objectUid="+e.currentTarget.dataset.uid})},goToUserList:function(){r.navigateTo({url:"/pages/searchUserResult/searchUserResult?searchValue="+this.data.searchValue})},onReachBottom:function(){this.data.pageSearchResult&&(H.sensors.track("refresh",{refreshType:"loadmore"}),this.setData({hasMoreData:!0}),this.data.page=this.data.page+1,L.getSearchContent(this.data.searchValue,this.data.page,this.getSearchContentSuccessHandler.bind(this)))},retryGetHotSearchListSuccessHandler:function(e){"-100"==e.errno||"-200"==e.errno?this.hotSearchFailHandler(e):this.getHotSearchListSuccessHandler(e)},getHotSearchListSuccessHandler:function(e){var t=this;e&&e.errno&&("-100"==e.errno||"-200"==e.errno)?b.default.updateUserStatus(function(){L.getHotSearchList(t.retryGetHotSearchListSuccessHandler.bind(t),t.hotSearchFailHandler.bind(t))}):e&&"1040002"==e.errno?(this.setData({startLoading:!1,error:!0,networkAvailable:!1,errMsg:void 0==e.errmsg?"":e.errmsg}),r.hideLoading()):r.hideLoading();var a=f.parseHotSearch(e);this.setData({startLoading:!1,title:a.title,hotListCards:a.cardsList})},hotSearchFailHandler:function(e){this.setData({startLoading:!1,error:!0,networkAvailable:!1}),r.hideLoading()},retryGetSearchContentSuccessHandler:function(e){"-100"!=e.errno||"-200"==e.errno?this.hotSearchFailHandler(e):this.getSearchContentSuccessHandler(e)},getSearchContentSuccessHandler:function(e){var t=this;if(e&&e.errno&&("-100"==e.errno||"-200"==e.errno))return void b.default.updateUserStatus(function(){L.getSearchContent(t.data.searchValue,t.data.page,t.retryGetSearchContentSuccessHandler.bind(t),t.hotSearchFailHandler.bind(t))});if(e&&"1040002"==e.errno)return void this.setData({startLoading:!1,error:!0,networkAvailable:!1});var a=f.parseHotSearchContent(e);void 0!=a.errMsg?(this.setData({hasMoreData:!1,errMsg:a.errMsg,returnErrorCode:e.cards&&e.cards.length>0&&e.cards[0].itemid?e.cards[0].itemid:"",startLoading:!1,needLogin:0==H.globalData.userStatus,error:!0}),this.trackSearch("2")):0==a.statuses.length?(this.setData({hasMoreData:!1,error:!1}),this.trackSearch("1")):(this.setData({hasMoreData:!1,statuses:this.data.statuses.concat(D.removeRepeatedBlog(a.statuses,this.data.contentSet)),startLoading:!1,needLogin:0==H.globalData.userStatus,error:!1}),this.trackSearch("0"))},trackSearch:function(e){"hotWord"==this.data.searchType?H.sensors.track("search",{keyword:this.data.searchValue,searchType:this.data.searchType,hasResult:e,hotSearchNumber:void 0==this.data.hotSearchNumber?"":this.data.hotSearchNumber.toString()}):"inputWord"==this.data.searchType&&H.sensors.track("search",{keyword:this.data.searchValue,searchType:this.data.searchType,hasResult:e})},retryGetSearchUserListHandler:function(e){"-100"==e.errno||"-200"==e.errno?this.hotSearchFailHandler(e):this.getSearchUserListSuccessHandler(e)},getSearchUserListSuccessHandler:function(e){var t=this;"-100"==e.errno||"-200"==e.errno?b.default.updateUserStatus(function(){L.getSearchUserList(t.data.searchValue,t.data.userPage,t.retryGetSearchUserListHandler.bind(t),t.hotSearchFailHandler.bind(t))}):void 0!=e.errno&&"1040002"==e.errno&&this.setData({startLoading:!1,error:!0,networkAvailable:!1});var a=f.parseHotSearchUserList(e);this.data.pageUserList=a,0==a.length?this.setData({hasMoreUser:!1}):(a.length>11&&(a=a.slice(0,11)),this.setData({hasMoreUser:!0,userList:a,userLength:a.length-1,error:!1}))}})}),window.__swanRoute="pages/hotSearch/hotSearch",window.usingComponents=["common/FeedList/FeedList","common/Search/Search","common/Error/Error","common/NetworkErrorToast/NetworkErrorToast"],require("pages/hotSearch/hotSearch");